<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é’»çŸ³ç‹‚çƒ­è€… - è®©äººä¸Šç˜¾çš„ç‚¹å‡»æ¸¸æˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
            color: #FFD700;
        }
        
        .logo h1 {
            font-size: 2.2rem;
            background: linear-gradient(to right, #FFD700, #FFA500);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        
        .stats {
            display: flex;
            gap: 30px;
            font-size: 1.3rem;
        }
        
        .stat-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stat-box i {
            color: #FFD700;
        }
        
        .diamond-count, .coins-count {
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        .main-game-area {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .clicker-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .clicker-title {
            font-size: 1.8rem;
            margin-bottom: 30px;
            color: #FFD700;
            text-align: center;
        }
        
        .clicker-button {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: linear-gradient(145deg, #FFD700, #FFA500);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 8px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 0 30px rgba(255, 215, 0, 0.5),
                inset 0 0 30px rgba(255, 255, 255, 0.2);
            transition: all 0.1s;
            margin-bottom: 30px;
            overflow: hidden;
            position: relative;
        }
        
        .clicker-button:active {
            transform: scale(0.95);
            box-shadow: 
                0 0 20px rgba(255, 215, 0, 0.7),
                inset 0 0 20px rgba(0, 0, 0, 0.2);
        }
        
        .clicker-button i {
            font-size: 8rem;
            color: white;
            filter: drop-shadow(0 0 10px rgba(0, 0, 0, 0.3));
        }
        
        .clicker-stats {
            display: flex;
            gap: 30px;
            text-align: center;
        }
        
        .click-stat {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 25px;
            border-radius: 15px;
            min-width: 150px;
        }
        
        .click-stat h3 {
            color: #aaa;
            font-size: 1rem;
            margin-bottom: 5px;
        }
        
        .click-stat p {
            font-size: 1.8rem;
            font-weight: bold;
            color: #FFD700;
        }
        
        .shop-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            color: #FFD700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .upgrade-item, .auto-clicker-item, .skin-item, .boost-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s;
            border: 1px solid transparent;
        }
        
        .upgrade-item:hover, .auto-clicker-item:hover, .skin-item:hover, .boost-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 215, 0, 0.3);
        }
        
        .upgrade-info h4, .auto-clicker-info h4, .skin-info h4, .boost-info h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .upgrade-info p, .auto-clicker-info p, .skin-info p, .boost-info p {
            color: #aaa;
            font-size: 0.9rem;
        }
        
        .upgrade-price, .auto-clicker-price, .skin-price, .boost-price {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: bold;
            font-size: 1.2rem;
            color: #FFD700;
        }
        
        .buy-btn {
            background: linear-gradient(to right, #4CAF50, #2E7D32);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .buy-btn:hover:not(:disabled) {
            background: linear-gradient(to right, #66BB6A, #388E3C);
            transform: translateY(-2px);
        }
        
        .buy-btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
        }
        
        .tab-content {
            display: none;
            flex-grow: 1;
            overflow-y: auto;
            max-height: 400px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .recharge-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            margin-top: 30px;
        }
        
        .recharge-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .recharge-option {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .recharge-option:hover {
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.05);
        }
        
        .recharge-option.selected {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .recharge-diamond {
            font-size: 2rem;
            color: #FFD700;
            margin-bottom: 10px;
        }
        
        .recharge-price {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .recharge-btn {
            background: linear-gradient(to right, #FF5722, #E64A19);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 30px;
            transition: all 0.3s;
        }
        
        .recharge-btn:hover {
            background: linear-gradient(to right, #FF7043, #F4511E);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .recharge-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .recharge-modal-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            border: 2px solid #FFD700;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.3);
        }
        
        .recharge-modal h2 {
            color: #FFD700;
            margin-bottom: 20px;
            font-size: 2rem;
        }
        
        .qrcode-container {
            width: 250px;
            height: 250px;
            background: #fff;
            margin: 20px auto;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #333;
            font-weight: bold;
            border: 2px solid #FFD700;
            padding: 10px;
        }
        
        .qrcode-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .payment-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            display: none;
        }
        
        .payment-status.success {
            display: block;
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4CAF50;
            color: #4CAF50;
        }
        
        .payment-status.pending {
            display: block;
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #FFC107;
            color: #FFC107;
        }
        
        .payment-status.failed {
            display: block;
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #F44336;
            color: #F44336;
        }
        
        .close-modal {
            background: #FF5722;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }
        
        .close-modal:hover {
            background: #FF7043;
            transform: translateY(-2px);
        }
        
        .achievements {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .achievement {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .achievement-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(145deg, #FFD700, #FFA500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }
        
        .achievement-info h4 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .achievement-info p {
            color: #aaa;
            font-size: 0.9rem;
        }
        
        .achievement-progress {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            border-radius: 4px;
            width: 0%;
            transition: width 0.5s;
        }
        
        .achievement.unlocked .achievement-icon {
            background: linear-gradient(145deg, #4CAF50, #2E7D32);
        }
        
        .skin-preview {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .skin-preview i {
            font-size: 1.8rem;
        }
        
        .owned-tag {
            background: #4CAF50;
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .equip-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .equip-btn:hover:not(:disabled) {
            background: #42A5F5;
        }
        
        .equip-btn.equipped {
            background: #4CAF50;
        }
        
        .floating-diamond {
            position: absolute;
            font-size: 1.5rem;
            color: #FFD700;
            pointer-events: none;
            animation: floatUp 1s ease-out forwards;
        }
        
        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0.5);
            }
        }
        
        /* è½¬ç›˜æ ·å¼ */
        .wheel-container {
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .wheel-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .wheel {
            width: 300px;
            height: 300px;
            position: relative;
            margin: 0 auto 30px;
        }
        
        .wheel-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            transform: rotate(0deg);
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }
        
        .wheel-segment {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            left: 0;
            top: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .wheel-center {
            position: absolute;
            width: 80px;
            height: 80px;
            background: #FFD700;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 10;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
        }
        
        .wheel-spin-btn {
            background: linear-gradient(to right, #9C27B0, #673AB7);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }
        
        .wheel-spin-btn:hover:not(:disabled) {
            background: linear-gradient(to right, #AB47BC, #7E57C2);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .wheel-spin-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .wheel-result {
            margin-top: 20px;
            font-size: 1.3rem;
            color: #FFD700;
            text-align: center;
            min-height: 40px;
        }
        
        /* ä»»åŠ¡ç³»ç»Ÿ */
        .quests-container {
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .quest-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .quest-info h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .quest-info p {
            color: #aaa;
            font-size: 0.9rem;
        }
        
        .quest-reward {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            font-size: 1.2rem;
            color: #FFD700;
        }
        
        .quest-claim-btn {
            background: linear-gradient(to right, #2196F3, #1976D2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .quest-claim-btn:hover:not(:disabled) {
            background: linear-gradient(to right, #42A5F5, #2196F3);
            transform: translateY(-2px);
        }
        
        .quest-claim-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }
        
        /* æŠ€èƒ½ç³»ç»Ÿ */
        .skills-container {
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .skill-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .skill-info h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .skill-info p {
            color: #aaa;
            font-size: 0.9rem;
        }
        
        .skill-cooldown {
            color: #FF5722;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .skill-use-btn {
            background: linear-gradient(to right, #FF9800, #F57C00);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .skill-use-btn:hover:not(:disabled) {
            background: linear-gradient(to right, #FFB74D, #FF9800);
            transform: translateY(-2px);
        }
        
        .skill-use-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }
        
        /* æ’è¡Œæ¦œ */
        .leaderboard-container {
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .leaderboard-table th {
            text-align: left;
            padding: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            color: #FFD700;
        }
        
        .leaderboard-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .leaderboard-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .rank-1 {
            color: #FFD700;
            font-weight: bold;
        }
        
        .rank-2 {
            color: #C0C0C0;
            font-weight: bold;
        }
        
        .rank-3 {
            color: #CD7F32;
            font-weight: bold;
        }
        
        /* æ–°å¢æ ·å¼ */
        
        /* ç¦»çº¿æ”¶ç›Šæç¤º */
        .offline-earnings {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            animation: slideDown 0.5s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* è¿›åº¦æ¡åŠ¨ç”» */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }

        .clicker-button.pulse {
            animation: pulse 2s infinite;
        }

        /* æˆå°±è§£é”ç‰¹æ•ˆ */
        .achievement.unlocked {
            animation: achievementUnlock 0.5s ease;
        }

        @keyframes achievementUnlock {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* æ•°å­—å¢é•¿åŠ¨ç”» */
        .stat-increasing {
            animation: numberIncrease 0.3s ease;
            color: #4CAF50;
        }

        @keyframes numberIncrease {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* åŠ è½½é®ç½© */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            flex-direction: column;
            color: white;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #FFD700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* è®¾ç½®èœå• */
        .settings-container {
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #4CAF50;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* ç»Ÿè®¡ä¿¡æ¯é¢æ¿ */
        .stats-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            color: #FFD700;
            font-weight: bold;
            margin-top: 5px;
        }

        /* æ–°æ‰‹å¼•å¯¼ */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .tutorial-box {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            border: 2px solid #FFD700;
            position: relative;
        }

        .tutorial-step {
            display: none;
        }

        .tutorial-step.active {
            display: block;
        }

        .tutorial-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        /* æˆå°±ç‰¹æ•ˆ */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #FFD700;
            opacity: 0;
            z-index: 9998;
            pointer-events: none;
        }

        /* å¤§æ•°å­—åŠ¨ç”» */
        .big-number {
            font-size: 3rem;
            color: #FFD700;
            text-align: center;
            animation: bigNumber 2s ease-out;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9997;
            pointer-events: none;
        }

        @keyframes bigNumber {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -100%) scale(1.5); opacity: 1; }
            100% { transform: translate(-50%, -150%) scale(1); opacity: 0; }
        }

        /* æŒ‰é’®ç‚¹å‡»ç‰¹æ•ˆ */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }

        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* ç­‰çº§è¿›åº¦æ¡ */
        .level-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 15px;
        }

        .level-progress {
            flex-grow: 1;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .level-fill {
            height: 100%;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* å­˜å‚¨æç¤º */
        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: #4CAF50;
            padding: 10px 20px;
            border-radius: 20px;
            display: none;
            z-index: 1000;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; transform: translateY(10px); }
            10%, 90% { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 900px) {
            .main-game-area {
                grid-template-columns: 1fr;
            }
            
            .clicker-button {
                width: 250px;
                height: 250px;
            }
            
            .clicker-button i {
                font-size: 6rem;
            }
            
            .wheel {
                width: 250px;
                height: 250px;
            }
            
            .stats-panel {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 600px) {
            header {
                flex-direction: column;
                gap: 20px;
            }
            
            .stats {
                width: 100%;
                justify-content: space-around;
            }
            
            .clicker-stats {
                flex-direction: column;
                gap: 15px;
            }
            
            .recharge-options {
                grid-template-columns: 1fr;
            }
            
            .wheel {
                width: 200px;
                height: 200px;
            }
            
            .wheel-center {
                width: 60px;
                height: 60px;
                font-size: 1.2rem;
            }
            
            .stats-panel {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- åŠ è½½é®ç½© -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <h2>åŠ è½½æ¸¸æˆä¸­...</h2>
        <p id="loadingProgress">0%</p>
    </div>

    <!-- æ–°æ‰‹å¼•å¯¼ -->
    <div class="tutorial-overlay" id="tutorialOverlay">
        <div class="tutorial-box">
            <div class="tutorial-step active" id="tutorialStep1">
                <h2 style="color: #FFD700;">æ¬¢è¿æ¥åˆ°é’»çŸ³ç‹‚çƒ­è€…ï¼</h2>
                <p>è¿™æ˜¯ä¸€ä¸ªç‚¹å‡»æ¸¸æˆï¼Œä½ éœ€è¦ä¸æ–­ç‚¹å‡»è·å–é’»çŸ³ï¼Œç„¶åç”¨é’»çŸ³è´­ä¹°å‡çº§å’Œè‡ªåŠ¨ç‚¹å‡»å™¨ã€‚</p>
                <div class="tutorial-navigation">
                    <button onclick="nextTutorialStep()" class="buy-btn">ä¸‹ä¸€æ­¥</button>
                </div>
            </div>
            <div class="tutorial-step" id="tutorialStep2">
                <h2 style="color: #FFD700;">æ¸¸æˆç›®æ ‡</h2>
                <p>1. ç‚¹å‡»ä¸­é—´çš„é’»çŸ³è·å¾—é’»çŸ³</p>
                <p>2. ç”¨é’»çŸ³è´­ä¹°å‡çº§æ¥æé«˜æ¯æ¬¡ç‚¹å‡»çš„æ”¶ç›Š</p>
                <p>3. è´­ä¹°è‡ªåŠ¨ç‚¹å‡»å™¨è®©é’»çŸ³è‡ªåŠ¨å¢é•¿</p>
                <p>4. è§£é”çš®è‚¤ã€å®Œæˆä»»åŠ¡ã€è·å¾—æˆå°±</p>
                <div class="tutorial-navigation">
                    <button onclick="prevTutorialStep()" class="buy-btn">ä¸Šä¸€æ­¥</button>
                    <button onclick="nextTutorialStep()" class="buy-btn">ä¸‹ä¸€æ­¥</button>
                </div>
            </div>
            <div class="tutorial-step" id="tutorialStep3">
                <h2 style="color: #FFD700;">é‡è¦åŠŸèƒ½</h2>
                <p>â€¢ <strong>è½¬ç›˜æŠ½å¥–</strong>: æ¯å¤©æœ‰å…è´¹æŠ½å¥–æœºä¼š</p>
                <p>â€¢ <strong>æ¯æ—¥ä»»åŠ¡</strong>: å®Œæˆä»»åŠ¡è·å¾—é¢å¤–å¥–åŠ±</p>
                <p>â€¢ <strong>æŠ€èƒ½ç³»ç»Ÿ</strong>: ä½¿ç”¨æŠ€èƒ½è·å¾—é¢å¤–æ”¶ç›Š</p>
                <p>â€¢ <strong>æˆå°±ç³»ç»Ÿ</strong>: è¾¾æˆç›®æ ‡è·å¾—ä¸°åšå¥–åŠ±</p>
                <div class="tutorial-navigation">
                    <button onclick="prevTutorialStep()" class="buy-btn">ä¸Šä¸€æ­¥</button>
                    <button onclick="completeTutorial()" class="buy-btn">å¼€å§‹æ¸¸æˆ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¦»çº¿æ”¶ç›Šæç¤º -->
    <div class="offline-earnings" id="offlineEarnings" style="display: none;">
        <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>
                <h3><i class="fas fa-clock"></i> ç¦»çº¿æ”¶ç›Š</h3>
                <p id="offlineTime">ç¦»çº¿æ—¶é—´: 0å°æ—¶0åˆ†é’Ÿ</p>
                <p id="offlineReward">è·å¾—é’»çŸ³: 0</p>
            </div>
            <button class="buy-btn" onclick="claimOfflineEarnings()">é¢†å–</button>
        </div>
    </div>

    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-gem"></i>
                <h1>é’»çŸ³ç‹‚çƒ­è€…</h1>
            </div>
            <div class="stats">
                <div class="stat-box">
                    <i class="fas fa-gem"></i>
                    <div>
                        <div>é’»çŸ³</div>
                        <div class="diamond-count" id="diamondCount">0</div>
                    </div>
                </div>
                <div class="stat-box">
                    <i class="fas fa-coins"></i>
                    <div>
                        <div>æ¯ç§’æ”¶ç›Š</div>
                        <div class="coins-count" id="perSecond">0</div>
                    </div>
                </div>
                <div class="stat-box">
                    <i class="fas fa-level-up-alt"></i>
                    <div>
                        <div>ç­‰çº§</div>
                        <div class="coins-count" id="playerLevel">1</div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- ç­‰çº§è¿›åº¦æ¡ -->
        <div class="level-container">
            <span>ç­‰çº§ <span id="currentLevel">1</span></span>
            <div class="level-progress">
                <div class="level-fill" id="levelFill" style="width: 0%;"></div>
            </div>
            <span>ç­‰çº§ <span id="nextLevel">2</span></span>
        </div>
        
        <div class="main-game-area">
            <div class="clicker-section">
                <h2 class="clicker-title">ç‚¹å‡»è·å–é’»çŸ³ï¼</h2>
                <div class="clicker-button" id="clickerButton">
                    <i class="fas fa-gem" id="mainGem"></i>
                </div>
                <div class="clicker-stats">
                    <div class="click-stat">
                        <h3>æ¯æ¬¡ç‚¹å‡»</h3>
                        <p id="clickValue">1</p>
                    </div>
                    <div class="click-stat">
                        <h3>è‡ªåŠ¨ç‚¹å‡»å™¨</h3>
                        <p id="autoClickerCount">0</p>
                    </div>
                    <div class="click-stat">
                        <h3>æ€»ç‚¹å‡»æ¬¡æ•°</h3>
                        <p id="totalClicks">0</p>
                    </div>
                </div>
            </div>
            
            <div class="shop-section">
                <div class="tabs">
                    <div class="tab active" data-tab="upgrades">å‡çº§</div>
                    <div class="tab" data-tab="auto-clickers">è‡ªåŠ¨ç‚¹å‡»å™¨</div>
                    <div class="tab" data-tab="skins">çš®è‚¤</div>
                    <div class="tab" data-tab="boosts">å¢ç›Š</div>
                </div>
                
                <div class="tab-content active" id="upgrades">
                    <h3 class="section-title"><i class="fas fa-arrow-up"></i> ç‚¹å‡»å‡çº§</h3>
                    <div id="upgradesList">
                        <!-- å‡çº§é¡¹å°†é€šè¿‡JSç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="tab-content" id="auto-clickers">
                    <h3 class="section-title"><i class="fas fa-robot"></i> è‡ªåŠ¨ç‚¹å‡»å™¨</h3>
                    <div id="autoClickersList">
                        <!-- è‡ªåŠ¨ç‚¹å‡»å™¨å°†é€šè¿‡JSç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="tab-content" id="skins">
                    <h3 class="section-title"><i class="fas fa-palette"></i> çš®è‚¤å•†åº—</h3>
                    <div id="skinsList">
                        <!-- çš®è‚¤å°†é€šè¿‡JSç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="tab-content" id="boosts">
                    <h3 class="section-title"><i class="fas fa-bolt"></i> å¢ç›Šæ•ˆæœ</h3>
                    <div id="boostsList">
                        <!-- å¢ç›Šå°†é€šè¿‡JSç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ç»Ÿè®¡ä¿¡æ¯é¢æ¿ -->
        <div class="stats-panel" id="statsPanel">
            <div class="stat-item">
                <div>æ€»æ¸¸æˆæ—¶é—´</div>
                <div class="stat-value" id="totalPlayTime">0å°æ—¶</div>
            </div>
            <div class="stat-item">
                <div>ç‚¹å‡»æ•ˆç‡</div>
                <div class="stat-value" id="clickEfficiency">0/ç§’</div>
            </div>
            <div class="stat-item">
                <div>å‡çº§æ€»æ•°</div>
                <div class="stat-value" id="totalUpgrades">0</div>
            </div>
            <div class="stat-item">
                <div>çš®è‚¤æ€»æ•°</div>
                <div class="stat-value" id="totalSkins">1</div>
            </div>
        </div>
        
        <!-- è½¬ç›˜æŠ½å¥– -->
        <div class="wheel-container">
            <h2 class="section-title"><i class="fas fa-sync-alt"></i> å¹¸è¿å¤§è½¬ç›˜</h2>
            <div class="wheel-wrapper">
                <div class="wheel">
                    <div class="wheel-circle" id="wheelCircle">
                        <!-- è½¬ç›˜æ‰‡åŒºå°†é€šè¿‡JSç”Ÿæˆ -->
                    </div>
                    <div class="wheel-center" id="spinWheel">
                        <i class="fas fa-redo"></i>
                    </div>
                </div>
                <div class="wheel-result" id="wheelResult">
                    æ¯æ¬¡æŠ½å¥–æ¶ˆè€— 500 é’»çŸ³ï¼Œç‚¹å‡»è½¬ç›˜ä¸­å¿ƒå¼€å§‹
                </div>
                <button class="wheel-spin-btn" id="wheelSpinBtn" disabled>
                    å…è´¹æŠ½å¥–å‰©ä½™: <span id="freeSpins">0</span>
                </button>
            </div>
        </div>
        
        <!-- ä»»åŠ¡ç³»ç»Ÿ -->
        <div class="quests-container">
            <h2 class="section-title"><i class="fas fa-tasks"></i> æ¯æ—¥ä»»åŠ¡</h2>
            <div id="questsList">
                <!-- ä»»åŠ¡å°†é€šè¿‡JSç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- æŠ€èƒ½ç³»ç»Ÿ -->
        <div class="skills-container">
            <h2 class="section-title"><i class="fas fa-magic"></i> ç‰¹æ®ŠæŠ€èƒ½</h2>
            <div id="skillsList">
                <!-- æŠ€èƒ½å°†é€šè¿‡JSç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- è®¾ç½®èœå• -->
        <div class="settings-container">
            <h2 class="section-title"><i class="fas fa-cog"></i> æ¸¸æˆè®¾ç½®</h2>
            <div class="setting-item">
                <div>
                    <h4>éŸ³æ•ˆ</h4>
                    <p>å¼€å¯æˆ–å…³é—­æ¸¸æˆéŸ³æ•ˆ</p>
                </div>
                <label class="switch">
                    <input type="checkbox" id="soundToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div>
                    <h4>åŠ¨ç”»æ•ˆæœ</h4>
                    <p>å¼€å¯æˆ–å…³é—­è§†è§‰ç‰¹æ•ˆ</p>
                </div>
                <label class="switch">
                    <input type="checkbox" id="animationToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div>
                    <h4>ç¦»çº¿æ”¶ç›Š</h4>
                    <p>ç¦»çº¿æ—¶è‡ªåŠ¨è·å–æ”¶ç›Š</p>
                </div>
                <label class="switch">
                    <input type="checkbox" id="offlineEarningsToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div>
                    <h4>è‡ªåŠ¨ä¿å­˜</h4>
                    <p>è‡ªåŠ¨ä¿å­˜æ¸¸æˆè¿›åº¦</p>
                </div>
                <label class="switch">
                    <input type="checkbox" id="autoSaveToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                <button class="buy-btn" onclick="exportSave()">
                    <i class="fas fa-download"></i> å¯¼å‡ºå­˜æ¡£
                </button>
                <button class="buy-btn" onclick="importSave()">
                    <i class="fas fa-upload"></i> å¯¼å…¥å­˜æ¡£
                </button>
                <button class="buy-btn" style="background: #F44336;" onclick="resetGame()">
                    <i class="fas fa-redo"></i> é‡ç½®æ¸¸æˆ
                </button>
            </div>
        </div>
        
        <!-- å……å€¼éƒ¨åˆ† -->
        <div class="recharge-section">
            <h2 class="section-title"><i class="fas fa-shopping-cart"></i> é’»çŸ³å……å€¼</h2>
            <p style="margin-bottom: 20px; color: #aaa;">1å…ƒ = 10,000é’»çŸ³ï¼Œè´­ä¹°çš®è‚¤å’ŒåŠ é€Ÿæ¸¸æˆè¿›åº¦</p>
            
            <div class="recharge-options">
                <div class="recharge-option" data-amount="10000" data-price="1">
                    <div class="recharge-diamond">10,000 ğŸ’</div>
                    <div class="recharge-price">ï¿¥1</div>
                    <div style="color: #aaa; font-size: 0.9rem;">æ–°æ‰‹æ¨è</div>
                </div>
                <div class="recharge-option selected" data-amount="50000" data-price="5">
                    <div class="recharge-diamond">50,000 ğŸ’</div>
                    <div class="recharge-price">ï¿¥5</div>
                    <div style="color: #aaa; font-size: 0.9rem;">è¶…å€¼ä¼˜æƒ </div>
                </div>
                <div class="recharge-option" data-amount="150000" data-price="15">
                    <div class="recharge-diamond">150,000 ğŸ’</div>
                    <div class="recharge-price">ï¿¥15</div>
                    <div style="color: #aaa; font-size: 0.9rem;">é¢å¤–èµ é€ 20,000 ğŸ’</div>
                </div>
                <div class="recharge-option" data-amount="300000" data-price="30">
                    <div class="recharge-diamond">300,000 ğŸ’</div>
                    <div class="recharge-price">ï¿¥30</div>
                    <div style="color: #aaa; font-size: 0.9rem;">é¢å¤–èµ é€ 50,000 ğŸ’</div>
                </div>
                <div class="recharge-option" data-amount="1000000" data-price="100">
                    <div class="recharge-diamond">1,000,000 ğŸ’</div>
                    <div class="recharge-price">ï¿¥100</div>
                    <div style="color: #aaa; font-size: 0.9rem;">VIPç‰¹æƒ  + 200,000 ğŸ’</div>
                </div>
            </div>
            
            <button class="recharge-btn" id="rechargeBtn">
                <i class="fas fa-bolt"></i> ç«‹å³å……å€¼
            </button>
        </div>
        
        <!-- æ’è¡Œæ¦œ -->
        <div class="leaderboard-container">
            <h2 class="section-title"><i class="fas fa-crown"></i> æ’è¡Œæ¦œ</h2>
            <table class="leaderboard-table">
                <thead>
                    <tr>
                        <th>æ’å</th>
                        <th>ç©å®¶</th>
                        <th>é’»çŸ³æ€»æ•°</th>
                        <th>ç‚¹å‡»æ¬¡æ•°</th>
                        <th>ç­‰çº§</th>
                    </tr>
                </thead>
                <tbody id="leaderboardBody">
                    <!-- æ’è¡Œæ¦œæ•°æ®å°†é€šè¿‡JSç”Ÿæˆ -->
                </tbody>
            </table>
        </div>
        
        <!-- æˆå°±ç³»ç»Ÿ -->
        <div style="margin-top: 40px;">
            <h2 class="section-title"><i class="fas fa-trophy"></i> æˆå°±ç³»ç»Ÿ</h2>
            <div class="achievements" id="achievementsList">
                <!-- æˆå°±å°†é€šè¿‡JSç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- å……å€¼æ¨¡æ€æ¡† -->
    <div class="recharge-modal" id="rechargeModal">
        <div class="recharge-modal-content">
            <h2>å¾®ä¿¡æ”¯ä»˜</h2>
            <p>è¯·ä½¿ç”¨å¾®ä¿¡æ‰«æä¸‹æ–¹äºŒç»´ç å®Œæˆæ”¯ä»˜</p>
            <p style="margin-bottom: 20px; color: #FFD700; font-size: 1.2rem;" id="rechargeAmountText">å……å€¼é‡‘é¢ï¼šï¿¥5ï¼Œè·å¾—50,000é’»çŸ³</p>
            
            <!-- æ‚¨çš„å¾®ä¿¡æ”¶æ¬¾ç  -->
            <div class="qrcode-container">
                <img src="IMG_8993.jpeg" alt="å¾®ä¿¡æ”¯ä»˜äºŒç»´ç " onerror="this.onerror=null; this.innerHTML='<h3>æ”¯ä»˜äºŒç»´ç </h3><p>è¯·æ‰«ç æ”¯ä»˜</p>'; this.style.display=\'flex\'; this.style.flexDirection=\'column\'; this.style.alignItems=\'center\'; this.style.justifyContent=\'center\';">
            </div>
            
            <p style="margin-top: 20px; color: #aaa; font-size: 0.9rem;">
                æ”¯ä»˜å®Œæˆåï¼Œè¯·ç­‰å¾…ç³»ç»ŸéªŒè¯<br>
                <strong>è¯·å‹¿å…³é—­æ­¤çª—å£ï¼Œæ”¯ä»˜æˆåŠŸåé’»çŸ³å°†è‡ªåŠ¨åˆ°è´¦</strong>
            </p>
            
            <div class="payment-status" id="paymentStatus">
                <!-- æ”¯ä»˜çŠ¶æ€ä¿¡æ¯ -->
            </div>
            
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px; flex-wrap: wrap;">
                <button class="close-modal" id="checkPayment">æ£€æŸ¥æ”¯ä»˜çŠ¶æ€</button>
                <button class="close-modal" id="cancelRecharge">å–æ¶ˆæ”¯ä»˜</button>
            </div>
        </div>
    </div>
    
    <!-- å­˜å‚¨æç¤º -->
    <div class="save-indicator" id="saveIndicator">
        <i class="fas fa-save"></i> æ¸¸æˆå·²ä¿å­˜
    </div>
    
    <script>
        // ============================================
        // æ¸¸æˆé…ç½®
        // ============================================
        const GAME_CONFIG = {
            version: '1.2.0',
            maxOfflineHours: 24,
            autoSaveInterval: 30000, // 30ç§’
            offlineMultiplier: 0.5, // ç¦»çº¿æ”¶ç›Šä¸ºåœ¨çº¿æ”¶ç›Šçš„50%
            tutorialEnabled: true,
            soundEnabled: true,
            animationEnabled: true
        };

        // ============================================
        // æ¸¸æˆçŠ¶æ€
        // ============================================
        const gameState = {
            diamonds: 0,
            perClick: 1,
            totalClicks: 0,
            perSecond: 0,
            totalAutoClickers: 0,
            autoClickers: [], // å­˜å‚¨æ¯ä¸ªè‡ªåŠ¨ç‚¹å‡»å™¨çš„çŠ¶æ€
            upgrades: [],
            skins: [],
            achievements: [],
            boosts: [],
            skills: [],
            quests: [],
            selectedSkin: 'default',
            selectedRechargeOption: { amount: 50000, price: 5 },
            pendingPayment: null,
            freeSpins: 3,
            wheelSpinning: false,
            playerLevel: 1,
            playerXP: 0,
            playerName: 'é’»çŸ³ç©å®¶',
            lastLoginDate: new Date().toDateString(),
            totalPlayTime: 0, // æ€»æ¸¸æˆæ—¶é—´ï¼ˆç§’ï¼‰
            lastSaveTime: Date.now(),
            settings: {
                sound: true,
                animation: true,
                offlineEarnings: true,
                autoSave: true
            },
            tutorialCompleted: false,
            gameVersion: GAME_CONFIG.version,
            statistics: {
                highestDiamonds: 0,
                highestPerSecond: 0,
                totalDiamondsEarned: 0,
                totalUpgradesBought: 0,
                totalSkinsUnlocked: 1,
                totalAchievements: 0
            }
        };

        // ============================================
        // æ¸¸æˆæ•°æ®
        // ============================================
        
        // å‡çº§é¡¹æ•°æ®
        const upgradesData = [
            { id: 1, name: "å¼ºåŒ–æ‰‹æŒ‡", description: "æ¯æ¬¡ç‚¹å‡»+1é’»çŸ³", price: 50, increase: 1, owned: 0, max: 20 },
            { id: 2, name: "é»„é‡‘æ‰‹å¥—", description: "æ¯æ¬¡ç‚¹å‡»+2é’»çŸ³", price: 200, increase: 2, owned: 0, max: 10 },
            { id: 3, name: "é’»çŸ³é•", description: "æ¯æ¬¡ç‚¹å‡»+5é’»çŸ³", price: 1000, increase: 5, owned: 0, max: 5 },
            { id: 4, name: "å¹¸è¿å®çŸ³", description: "æœ‰10%å‡ ç‡è·å¾—10å€é’»çŸ³", price: 5000, increase: 0, owned: 0, max: 1 },
            { id: 5, name: "ç‚¹å‡»é£æš´", description: "æ¯æ¬¡ç‚¹å‡»æœ‰å‡ ç‡è§¦å‘è¿ç»­ç‚¹å‡»", price: 20000, increase: 0, owned: 0, max: 1 },
            { id: 6, name: "é‡å­æ‰‹æŒ‡", description: "æ¯æ¬¡ç‚¹å‡»+10é’»çŸ³", price: 50000, increase: 10, owned: 0, max: 3 },
            { id: 7, name: "å®‡å®™ä¹‹å¿ƒ", description: "æ¯æ¬¡ç‚¹å‡»+25é’»çŸ³", price: 200000, increase: 25, owned: 0, max: 2 },
            { id: 8, name: "æ— é™ä¹‹åŠ›", description: "æ¯æ¬¡ç‚¹å‡»+100é’»çŸ³", price: 1000000, increase: 100, owned: 0, max: 1 }
        ];

        // è‡ªåŠ¨ç‚¹å‡»å™¨æ•°æ®
        const autoClickersData = [
            { 
                id: 1, 
                name: "åˆçº§æœºå™¨äºº", 
                description: "æ¯ç§’è‡ªåŠ¨ç‚¹å‡»1æ¬¡", 
                basePrice: 100, 
                clicksPerSecond: 1, 
                owned: 0 
            },
            { 
                id: 2, 
                name: "ä¸­çº§æœºå™¨äºº", 
                description: "æ¯ç§’è‡ªåŠ¨ç‚¹å‡»3æ¬¡", 
                basePrice: 500, 
                clicksPerSecond: 3, 
                owned: 0 
            },
            { 
                id: 3, 
                name: "é«˜çº§æœºå™¨äºº", 
                description: "æ¯ç§’è‡ªåŠ¨ç‚¹å‡»10æ¬¡", 
                basePrice: 2000, 
                clicksPerSecond: 10, 
                owned: 0 
            },
            { 
                id: 4, 
                name: "é’»çŸ³æœºå™¨äºº", 
                description: "æ¯ç§’è‡ªåŠ¨ç‚¹å‡»25æ¬¡", 
                basePrice: 10000, 
                clicksPerSecond: 25, 
                owned: 0 
            },
            { 
                id: 5, 
                name: "è‡³å°Šæœºå™¨äºº", 
                description: "æ¯ç§’è‡ªåŠ¨ç‚¹å‡»50æ¬¡", 
                basePrice: 50000, 
                clicksPerSecond: 50, 
                owned: 0 
            },
            { 
                id: 6, 
                name: "é‡å­æœºå™¨äºº", 
                description: "æ¯ç§’è‡ªåŠ¨ç‚¹å‡»100æ¬¡", 
                basePrice: 200000, 
                clicksPerSecond: 100, 
                owned: 0 
            },
            { 
                id: 7, 
                name: "å®‡å®™æœºå™¨äºº", 
                description: "æ¯ç§’è‡ªåŠ¨ç‚¹å‡»250æ¬¡", 
                basePrice: 1000000, 
                clicksPerSecond: 250, 
                owned: 0 
            }
        ];

        // çš®è‚¤æ•°æ®
        const skinsData = [
            { id: 1, name: "é»˜è®¤çš®è‚¤", description: "åŸºç¡€é’»çŸ³å¤–è§‚", price: 0, icon: "fas fa-gem", color1: "#FFD700", color2: "#FFA500", owned: true, equipped: true },
            { id: 2, name: "çº¢å®çŸ³", description: "ç¨€æœ‰çº¢è‰²å®çŸ³", price: 5000, icon: "fas fa-gem", color1: "#FF4081", color2: "#D81B60", owned: false, equipped: false },
            { id: 3, name: "è“å®çŸ³", description: "æ·±æµ·è“è‰²å®çŸ³", price: 8000, icon: "fas fa-gem", color1: "#2979FF", color2: "#2962FF", owned: false, equipped: false },
            { id: 4, name: "ç¿¡ç¿ ", description: "ç¿ ç»¿è‰²å®çŸ³", price: 12000, icon: "fas fa-gem", color1: "#00E676", color2: "#00C853", owned: false, equipped: false },
            { id: 5, name: "ç´«æ°´æ™¶", description: "ç¥ç§˜ç´«è‰²å®çŸ³", price: 15000, icon: "fas fa-gem", color1: "#7C4DFF", color2: "#651FFF", owned: false, equipped: false },
            { id: 6, name: "é»‘é’»çŸ³", description: "ç¨€æœ‰é»‘è‰²é’»çŸ³", price: 30000, icon: "fas fa-gem", color1: "#455A64", color2: "#263238", owned: false, equipped: false },
            { id: 7, name: "å½©è™¹é’»çŸ³", description: "ä¸ƒå½©ç‚«å…‰é’»çŸ³", price: 50000, icon: "fas fa-gem", color1: "#FF4081", color2: "#2979FF", owned: false, equipped: false },
            { id: 8, name: "æ˜Ÿç©ºå®çŸ³", description: "æ˜Ÿç©ºç‰¹æ•ˆå®çŸ³", price: 80000, icon: "fas fa-star", color1: "#311B92", color2: "#1A237E", owned: false, equipped: false },
            { id: 9, name: "ç«ç„°å®çŸ³", description: "ç‡ƒçƒ§çš„ç«ç„°å®çŸ³", price: 100000, icon: "fas fa-fire", color1: "#FF5722", color2: "#D84315", owned: false, equipped: false },
            { id: 10, name: "å†°éœœå®çŸ³", description: "å¯’å†·çš„å†°éœœå®çŸ³", price: 100000, icon: "fas fa-snowflake", color1: "#00BCD4", color2: "#0097A7", owned: false, equipped: false },
            { id: 11, name: "é—ªç”µå®çŸ³", description: "é—ªç”µç‰¹æ•ˆå®çŸ³", price: 150000, icon: "fas fa-bolt", color1: "#FFEB3B", color2: "#FDD835", owned: false, equipped: false },
            { id: 12, name: "é¾™æ™¶å®çŸ³", description: "ä¼ è¯´ä¸­çš„é¾™æ™¶", price: 200000, icon: "fas fa-dragon", color1: "#9C27B0", color2: "#7B1FA2", owned: false, equipped: false },
            { id: 13, name: "å¤©ä½¿ä¹‹æ³ª", description: "ç¥åœ£çš„å¤©ä½¿ä¹‹æ³ª", price: 250000, icon: "fas fa-feather-alt", color1: "#E1F5FE", color2: "#B3E5FC", owned: false, equipped: false },
            { id: 14, name: "æ¶é­”ä¹‹å¿ƒ", description: "é‚ªæ¶çš„æ¶é­”ä¹‹å¿ƒ", price: 250000, icon: "fas fa-skull-crossbones", color1: "#B71C1C", color2: "#880E4F", owned: false, equipped: false },
            { id: 15, name: "æ—¶é—´å®çŸ³", description: "æ§åˆ¶æ—¶é—´çš„å®çŸ³", price: 300000, icon: "fas fa-clock", color1: "#004D40", color2: "#00251A", owned: false, equipped: false },
            { id: 16, name: "æ— é™å®çŸ³", description: "å®‡å®™æ— é™å®çŸ³", price: 500000, icon: "fas fa-infinity", color1: "#6A1B9A", color2: "#4A148C", owned: false, equipped: false },
            { id: 17, name: "åˆ›ä¸–å®çŸ³", description: "åˆ›ä¸–ç¥çš„å®çŸ³", price: 1000000, icon: "fas fa-globe-americas", color1: "#1A237E", color2: "#0D47A1", owned: false, equipped: false },
            { id: 18, name: "èŠ‚æ—¥é™å®š", description: "èŠ‚æ—¥ç‰¹åˆ«é™å®šç‰ˆ", price: 0, icon: "fas fa-gift", color1: "#FF1744", color2: "#D50000", owned: false, equipped: false, special: true },
            { id: 19, name: "VIPä¸“å±", description: "VIPç©å®¶ä¸“å±çš®è‚¤", price: 0, icon: "fas fa-crown", color1: "#FFD700", color2: "#FFAB00", owned: false, equipped: false, special: true },
            { id: 20, name: "å¼€å‘è€…ç‰ˆ", description: "å¼€å‘è€…ç‰¹åˆ«ç‰ˆæœ¬", price: 0, icon: "fas fa-code", color1: "#00C853", color2: "#00E676", owned: false, equipped: false, special: true }
        ];

        // å¢ç›Šæ•ˆæœæ•°æ®
        const boostsData = [
            { id: 1, name: "2å€æ”¶ç›Š", description: "30åˆ†é’Ÿå†…ç‚¹å‡»æ”¶ç›Šç¿»å€", price: 5000, duration: 1800, multiplier: 2, active: false, endTime: 0 },
            { id: 2, name: "3å€æ”¶ç›Š", description: "15åˆ†é’Ÿå†…ç‚¹å‡»æ”¶ç›Š3å€", price: 10000, duration: 900, multiplier: 3, active: false, endTime: 0 },
            { id: 3, name: "è‡ªåŠ¨ç‚¹å‡»å™¨åŠ é€Ÿ", description: "60åˆ†é’Ÿå†…è‡ªåŠ¨ç‚¹å‡»å™¨é€Ÿåº¦ç¿»å€", price: 15000, duration: 3600, multiplier: 2, active: false, endTime: 0 },
            { id: 4, name: "æ— é™ç‚¹å‡»", description: "5åˆ†é’Ÿå†…ç‚¹å‡»æ— å†·å´", price: 20000, duration: 300, multiplier: 1, active: false, endTime: 0 },
            { id: 5, name: "é’»çŸ³é›¨", description: "10åˆ†é’Ÿå†…æ¯ç§’é¢å¤–è·å¾—100é’»çŸ³", price: 50000, duration: 600, multiplier: 1, active: false, endTime: 0 }
        ];

        // æŠ€èƒ½æ•°æ®
        const skillsData = [
            { id: 1, name: "é’»çŸ³é£æš´", description: "ç«‹å³è·å¾—1000é’»çŸ³", price: 0, cooldown: 300, lastUsed: 0, type: "instant" },
            { id: 2, name: "æ—¶é—´åŠ é€Ÿ", description: "è‡ªåŠ¨ç‚¹å‡»å™¨é€Ÿåº¦æé«˜5å€ï¼ŒæŒç»­30ç§’", price: 0, cooldown: 600, lastUsed: 0, type: "boost" },
            { id: 3, name: "æš´å‡»ç‚¹å‡»", description: "ä¸‹ä¸€æ¬¡ç‚¹å‡»è·å¾—100å€æ”¶ç›Š", price: 0, cooldown: 180, lastUsed: 0, type: "nextClick" },
            { id: 4, name: "å¬å”¤æœºå™¨äºº", description: "ç«‹å³è·å¾—ä¸€ä¸ªå…è´¹çš„é«˜çº§æœºå™¨äºº", price: 0, cooldown: 1800, lastUsed: 0, type: "instant" },
            { id: 5, name: "å¹¸è¿æ—¶åˆ»", description: "60ç§’å†…æ‰€æœ‰æ”¶ç›Šå¢åŠ 50%", price: 0, cooldown: 1200, lastUsed: 0, type: "boost" }
        ];

        // ä»»åŠ¡æ•°æ®
        const questsData = [
            { id: 1, name: "é¦–æ¬¡ç‚¹å‡»", description: "ç‚¹å‡»ä¸»æŒ‰é’®10æ¬¡", goal: 10, progress: 0, reward: 100, completed: false, claimed: false },
            { id: 2, name: "é’»çŸ³æ”¶é›†è€…", description: "æ”¶é›†1000é’»çŸ³", goal: 1000, progress: 0, reward: 500, completed: false, claimed: false },
            { id: 3, name: "å‡çº§å¤§å¸ˆ", description: "è´­ä¹°3æ¬¡å‡çº§", goal: 3, progress: 0, reward: 1000, completed: false, claimed: false },
            { id: 4, name: "è‡ªåŠ¨åŒ–å·¥", description: "æ‹¥æœ‰5ä¸ªè‡ªåŠ¨ç‚¹å‡»å™¨", goal: 5, progress: 0, reward: 2000, completed: false, claimed: false },
            { id: 5, name: "çš®è‚¤æ”¶è—å®¶", description: "è§£é”3ä¸ªçš®è‚¤", goal: 3, progress: 0, reward: 5000, completed: false, claimed: false },
            { id: 6, name: "ç™¾ä¸‡å¯Œç¿", description: "æ‹¥æœ‰1000000é’»çŸ³", goal: 1000000, progress: 0, reward: 10000, completed: false, claimed: false },
            { id: 7, name: "ç‚¹å‡»ç‹‚äºº", description: "ç‚¹å‡»1000æ¬¡", goal: 1000, progress: 0, reward: 5000, completed: false, claimed: false },
            { id: 8, name: "è½¬ç›˜é«˜æ‰‹", description: "ä½¿ç”¨è½¬ç›˜5æ¬¡", goal: 5, progress: 0, reward: 3000, completed: false, claimed: false }
        ];

        // æˆå°±æ•°æ®
        const achievementsData = [
            { id: 1, name: "åˆæ¬¡ç‚¹å‡»", description: "ç‚¹å‡»ä¸»æŒ‰é’®1æ¬¡", goal: 1, progress: 0, unlocked: false, reward: 100 },
            { id: 2, name: "ç‚¹å‡»æ–°æ‰‹", description: "ç‚¹å‡»ä¸»æŒ‰é’®100æ¬¡", goal: 100, progress: 0, unlocked: false, reward: 500 },
            { id: 3, name: "ç‚¹å‡»è¾¾äºº", description: "ç‚¹å‡»ä¸»æŒ‰é’®1000æ¬¡", goal: 1000, progress: 0, unlocked: false, reward: 2000 },
            { id: 4, name: "ç‚¹å‡»å¤§å¸ˆ", description: "ç‚¹å‡»ä¸»æŒ‰é’®10000æ¬¡", goal: 10000, progress: 0, unlocked: false, reward: 10000 },
            { id: 5, name: "é’»çŸ³æ”¶è—å®¶", description: "è·å¾—1000é’»çŸ³", goal: 1000, progress: 0, unlocked: false, reward: 1000 },
            { id: 6, name: "é’»çŸ³å¤§äº¨", description: "è·å¾—10000é’»çŸ³", goal: 10000, progress: 0, unlocked: false, reward: 5000 },
            { id: 7, name: "é’»çŸ³ä¹‹ç‹", description: "è·å¾—100000é’»çŸ³", goal: 100000, progress: 0, unlocked: false, reward: 20000 },
            { id: 8, name: "è‡ªåŠ¨åŒ–å¼€å§‹", description: "è´­ä¹°ç¬¬ä¸€ä¸ªè‡ªåŠ¨ç‚¹å‡»å™¨", goal: 1, progress: 0, unlocked: false, reward: 500 },
            { id: 9, name: "è‡ªåŠ¨åŒ–ä¸“å®¶", description: "æ‹¥æœ‰10ä¸ªè‡ªåŠ¨ç‚¹å‡»å™¨", goal: 10, progress: 0, unlocked: false, reward: 5000 },
            { id: 10, name: "çš®è‚¤æ”¶è—å®¶", description: "è§£é”ç¬¬ä¸€ä¸ªçš®è‚¤", goal: 1, progress: 0, unlocked: false, reward: 1000 },
            { id: 11, name: "çš®è‚¤å¤§å¸ˆ", description: "è§£é”10ä¸ªçš®è‚¤", goal: 10, progress: 0, unlocked: false, reward: 20000 },
            { id: 12, name: "å‡çº§å¤§å¸ˆ", description: "è´­ä¹°5æ¬¡å‡çº§", goal: 5, progress: 0, unlocked: false, reward: 2000 },
            { id: 13, name: "å‡çº§å®—å¸ˆ", description: "è´­ä¹°20æ¬¡å‡çº§", goal: 20, progress: 0, unlocked: false, reward: 10000 },
            { id: 14, name: "è½¬ç›˜çˆ±å¥½è€…", description: "ä½¿ç”¨è½¬ç›˜10æ¬¡", goal: 10, progress: 0, unlocked: false, reward: 5000 },
            { id: 15, name: "æŠ€èƒ½è¾¾äºº", description: "ä½¿ç”¨æ‰€æœ‰æŠ€èƒ½å„1æ¬¡", goal: 5, progress: 0, unlocked: false, reward: 10000 },
            { id: 16, name: "ä»»åŠ¡å®Œæˆè€…", description: "å®Œæˆæ‰€æœ‰æ¯æ—¥ä»»åŠ¡", goal: 8, progress: 0, unlocked: false, reward: 15000 },
            { id: 17, name: "VIPç©å®¶", description: "å……å€¼ä»»æ„é‡‘é¢", goal: 1, progress: 0, unlocked: false, reward: 5000 },
            { id: 18, name: "å¤§å®¢æˆ·", description: "ç´¯è®¡å……å€¼100å…ƒ", goal: 100, progress: 0, unlocked: false, reward: 50000 },
            { id: 19, name: "æ¸¸æˆä¹‹ç¥", description: "è¾¾åˆ°100çº§", goal: 100, progress: 0, unlocked: false, reward: 100000 },
            { id: 20, name: "ç»ˆææ”¶è—å®¶", description: "è§£é”æ‰€æœ‰çš®è‚¤", goal: 20, progress: 0, unlocked: false, reward: 50000 }
        ];

        // è½¬ç›˜å¥–å“
        const wheelPrizes = [
            { name: "100é’»çŸ³", value: 100, color: "#FFD700", probability: 30 },
            { name: "500é’»çŸ³", value: 500, color: "#FF9800", probability: 20 },
            { name: "1000é’»çŸ³", value: 1000, color: "#FF5722", probability: 15 },
            { name: "5000é’»çŸ³", value: 5000, color: "#9C27B0", probability: 10 },
            { name: "å…è´¹å‡çº§", value: "upgrade", color: "#4CAF50", probability: 10 },
            { name: "å…è´¹çš®è‚¤", value: "skin", color: "#2196F3", probability: 8 },
            { name: "10000é’»çŸ³", value: 10000, color: "#F44336", probability: 5 },
            { name: "ç¥ç§˜å¤§å¥–", value: "mystery", color: "#673AB7", probability: 2 }
        ];

        // æ’è¡Œæ¦œæ•°æ®
        const leaderboardData = [
            { rank: 1, name: "é’»çŸ³ç‹è€…", diamonds: 1250000, clicks: 58234, level: 87 },
            { rank: 2, name: "å®çŸ³æ”¶è—å®¶", diamonds: 987000, clicks: 45210, level: 76 },
            { rank: 3, name: "ç‚¹å‡»ç‹‚é­”", diamonds: 856000, clicks: 102345, level: 72 },
            { rank: 4, name: "çš®è‚¤å¤§å¸ˆ", diamonds: 723000, clicks: 38976, level: 68 },
            { rank: 5, name: "è‡ªåŠ¨åŒ–å·¥", diamonds: 654000, clicks: 28765, level: 65 },
            { rank: 6, name: "æ–°æ‰‹ç©å®¶", diamonds: 12300, clicks: 542, level: 12 },
            { rank: 7, name: "ä¼‘é—²ç©å®¶", diamonds: 8900, clicks: 321, level: 9 },
            { rank: 8, name: "å¹¸è¿å„¿", diamonds: 5600, clicks: 198, level: 7 },
            { rank: 9, name: "æ¢ç´¢è€…", diamonds: 2300, clicks: 87, level: 4 },
            { rank: 10, name: "æŒ‘æˆ˜è€…", diamonds: 1000, clicks: 45, level: 2 }
        ];

        // ============================================
        // å·¥å…·å‡½æ•°
        // ============================================
        
        // æ•°å­—æ ¼å¼åŒ–
        function formatNumber(num) {
            if (num >= 1000000000) {
                return (num / 1000000000).toFixed(2) + 'B';
            }
            if (num >= 1000000) {
                return (num / 1000000).toFixed(2) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return Math.floor(num).toString();
        }
        
        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(seconds) {
            if (seconds <= 0) return "0ç§’";
            
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            
            if (minutes > 0) {
                return `${minutes}åˆ†${remainingSeconds}ç§’`;
            } else {
                return `${remainingSeconds}ç§’`;
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            // åˆ›å»ºä¸€ä¸ªä¸´æ—¶é€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(to right, #4CAF50, #2E7D32);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                z-index: 10000;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
                max-width: 300px;
                word-wrap: break-word;
            `;
            
            notification.innerHTML = `<i class="fas fa-bell" style="margin-right: 10px;"></i> ${message}`;
            
            document.body.appendChild(notification);
            
            // 3ç§’åç§»é™¤é€šçŸ¥
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        
        // ============================================
        // æ ¸å¿ƒæ¸¸æˆå‡½æ•°
        // ============================================
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            showLoadingScreen();
            
            // åˆ†é˜¶æ®µåŠ è½½æ¸¸æˆ
            setTimeout(() => {
                loadGameState();
                updateLoadingProgress(30);
                
                setTimeout(() => {
                    updateUI();
                    setupEventListeners();
                    updateLoadingProgress(60);
                    
                    setTimeout(() => {
                        renderUpgrades();
                        renderAutoClickers();
                        renderSkins();
                        renderBoosts();
                        renderSkills();
                        renderQuests();
                        renderAchievements();
                        renderWheel();
                        renderLeaderboard();
                        updateLoadingProgress(90);
                        
                        setTimeout(() => {
                            // å¯åŠ¨æ¸¸æˆå¾ªç¯
                            setInterval(gameLoop, 1000);
                            
                            // è‡ªåŠ¨ä¿å­˜æ¸¸æˆ
                            setInterval(autoSaveGame, GAME_CONFIG.autoSaveInterval);
                            
                            // æ£€æŸ¥ç¦»çº¿æ”¶ç›Š
                            checkOfflineEarnings();
                            
                            // æ£€æŸ¥å…è´¹æŠ½å¥–
                            checkFreeSpins();
                            
                            // æ£€æŸ¥å¢ç›Šæ•ˆæœ
                            checkActiveBoosts();
                            
                            // æ£€æŸ¥æ˜¯å¦éœ€è¦æ˜¾ç¤ºæ–°æ‰‹å¼•å¯¼
                            if (GAME_CONFIG.tutorialEnabled && !gameState.tutorialCompleted) {
                                setTimeout(() => {
                                    showTutorial();
                                }, 1000);
                            }
                            
                            hideLoadingScreen();
                            updateLoadingProgress(100);
                        }, 500);
                    }, 500);
                }, 500);
            }, 500);
        }
        
        // åŠ è½½æ¸¸æˆçŠ¶æ€
        function loadGameState() {
            try {
                const saved = localStorage.getItem('diamondManiacGame');
                if (saved) {
                    const savedState = JSON.parse(saved);
                    
                    // ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥
                    if (savedState.gameVersion !== GAME_CONFIG.version) {
                        console.log('æ¸¸æˆç‰ˆæœ¬ä¸åŒï¼Œè¿›è¡Œæ•°æ®è¿ç§»');
                        migrateGameData(savedState);
                    }
                    
                    // æ¢å¤æ¸¸æˆçŠ¶æ€
                    Object.assign(gameState, savedState);
                    
                    // æ¢å¤æ—¥æœŸå¯¹è±¡
                    gameState.lastLoginDate = new Date(savedState.lastLoginDate);
                    gameState.lastSaveTime = savedState.lastSaveTime || Date.now();
                    
                    // ç¡®ä¿è‡ªåŠ¨ç‚¹å‡»å™¨æ•°æ®æ­£ç¡®
                    if (!gameState.autoClickers || gameState.autoClickers.length === 0) {
                        gameState.autoClickers = autoClickersData.map(clicker => ({ 
                            ...clicker, 
                            currentPrice: clicker.basePrice 
                        }));
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦ä¸ºåŒä¸€å¤©ï¼Œå¦‚æœä¸æ˜¯åˆ™é‡ç½®å…è´¹æŠ½å¥–å’Œä»»åŠ¡
                    const today = new Date().toDateString();
                    if (gameState.lastLoginDate.toDateString() !== today) {
                        gameState.freeSpins = 3;
                        resetDailyQuests();
                        gameState.lastLoginDate = new Date();
                    }
                    
                    // ç¡®ä¿è®¾ç½®å­˜åœ¨
                    if (!gameState.settings) {
                        gameState.settings = {
                            sound: true,
                            animation: true,
                            offlineEarnings: true,
                            autoSave: true
                        };
                    }
                    
                    console.log('æ¸¸æˆçŠ¶æ€åŠ è½½æˆåŠŸ');
                } else {
                    // åˆå§‹æ¸¸æˆçŠ¶æ€
                    initializeNewGame();
                }
                
                // è®¡ç®—æ¯ç§’æ”¶ç›Š
                calculatePerSecond();
                
            } catch (error) {
                console.error('åŠ è½½æ¸¸æˆçŠ¶æ€æ—¶å‡ºé”™:', error);
                // å¦‚æœåŠ è½½å¤±è´¥ï¼Œåˆå§‹åŒ–æ–°æ¸¸æˆ
                initializeNewGame();
            }
        }
        
        // åˆå§‹åŒ–æ–°æ¸¸æˆ
        function initializeNewGame() {
            console.log('åˆå§‹åŒ–æ–°æ¸¸æˆ');
            gameState.upgrades = upgradesData.map(upgrade => ({ ...upgrade }));
            gameState.skins = skinsData.map(skin => ({ ...skin }));
            gameState.boosts = boostsData.map(boost => ({ ...boost }));
            gameState.skills = skillsData.map(skill => ({ ...skill }));
            gameState.quests = questsData.map(quest => ({ ...quest }));
            gameState.achievements = achievementsData.map(achievement => ({ ...achievement }));
            gameState.autoClickers = autoClickersData.map(clicker => ({ 
                ...clicker, 
                currentPrice: clicker.basePrice 
            }));
            gameState.lastLoginDate = new Date();
            gameState.gameVersion = GAME_CONFIG.version;
            
            // ç¡®ä¿é»˜è®¤çš®è‚¤å·²æ‹¥æœ‰
            if (gameState.skins[0]) {
                gameState.skins[0].owned = true;
                gameState.skins[0].equipped = true;
            }
        }
        
        // ä¿å­˜æ¸¸æˆçŠ¶æ€
        function saveGameState() {
            try {
                gameState.lastSaveTime = Date.now();
                localStorage.setItem('diamondManiacGame', JSON.stringify(gameState));
                
                // æ˜¾ç¤ºä¿å­˜æç¤º
                if (gameState.settings.animation) {
                    showSaveIndicator();
                }
                
                console.log('æ¸¸æˆçŠ¶æ€å·²ä¿å­˜');
            } catch (error) {
                console.error('ä¿å­˜æ¸¸æˆçŠ¶æ€æ—¶å‡ºé”™:', error);
            }
        }
        
        function autoSaveGame() {
            if (gameState.settings.autoSave) {
                saveGameState();
            }
        }
        
        // é‡ç½®æ¯æ—¥ä»»åŠ¡
        function resetDailyQuests() {
            gameState.quests.forEach(quest => {
                quest.progress = 0;
                quest.completed = false;
                quest.claimed = false;
            });
            
            // æ›´æ–°ä»»åŠ¡æ˜¾ç¤º
            renderQuests();
        }
        
        // è®¡ç®—æ¯ç§’æ”¶ç›Š
        function calculatePerSecond() {
            let totalPerSecond = 0;
            let totalAutoClickers = 0;
            
            // è‡ªåŠ¨ç‚¹å‡»å™¨æ”¶ç›Š
            gameState.autoClickers.forEach(clicker => {
                totalAutoClickers += clicker.owned;
                totalPerSecond += clicker.owned * clicker.clicksPerSecond * gameState.perClick;
            });
            
            gameState.totalAutoClickers = totalAutoClickers;
            
            // åº”ç”¨å¢ç›Šæ•ˆæœ
            const activeBoost = gameState.boosts.find(boost => boost.active);
            if (activeBoost && activeBoost.multiplier > 1) {
                totalPerSecond *= activeBoost.multiplier;
            }
            
            // é’»çŸ³é›¨å¢ç›Š
            const diamondRainBoost = gameState.boosts.find(boost => boost.id === 5 && boost.active);
            if (diamondRainBoost) {
                totalPerSecond += 100;
            }
            
            // æŠ€èƒ½æ•ˆæœ
            const timeAccelerationSkill = gameState.skills.find(s => s.id === 2 && s.active);
            if (timeAccelerationSkill) {
                totalPerSecond *= 5;
            }
            
            const luckyMomentSkill = gameState.skills.find(s => s.id === 5 && s.active);
            if (luckyMomentSkill) {
                totalPerSecond *= 1.5;
            }
            
            gameState.perSecond = Math.floor(totalPerSecond);
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            if (gameState.perSecond > gameState.statistics.highestPerSecond) {
                gameState.statistics.highestPerSecond = gameState.perSecond;
            }
        }
        
        // æ¸¸æˆä¸»å¾ªç¯
        function gameLoop() {
            // è‡ªåŠ¨ç‚¹å‡»å™¨äº§ç”Ÿé’»çŸ³
            if (gameState.perSecond > 0) {
                const diamondsEarned = gameState.perSecond;
                gameState.diamonds += diamondsEarned;
                gameState.statistics.totalDiamondsEarned += diamondsEarned;
                
                // æ›´æ–°ç©å®¶ç»éªŒ
                gameState.playerXP += diamondsEarned / 1000;
                
                updateUI();
            }
            
            // æ›´æ–°æ¸¸æˆæ—¶é—´
            gameState.totalPlayTime++;
            
            // æ›´æ–°ä»»åŠ¡è¿›åº¦
            updateQuestProgress();
            
            // æ›´æ–°æˆå°±è¿›åº¦
            updateAchievementProgress();
            
            // æ›´æ–°æŠ€èƒ½å†·å´
            updateSkillCooldowns();
            
            // æ›´æ–°å¢ç›Šæ•ˆæœæ—¶é—´
            updateBoostTimers();
            
            // æ›´æ–°ç©å®¶ç­‰çº§
            updatePlayerLevel();
            
            // æ›´æ–°æ’è¡Œæ¦œä¸­çš„ç©å®¶æ•°æ®
            updateLeaderboardPlayerData();
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStatistics();
        }
        
        // ============================================
        // UIæ›´æ–°å‡½æ•°
        // ============================================
        
        // æ›´æ–°UI
        function updateUI() {
            const diamondElement = document.getElementById('diamondCount');
            const perSecondElement = document.getElementById('perSecond');
            const clickValueElement = document.getElementById('clickValue');
            const autoClickerElement = document.getElementById('autoClickerCount');
            const totalClicksElement = document.getElementById('totalClicks');
            const playerLevelElement = document.getElementById('playerLevel');
            
            const oldDiamonds = parseInt(diamondElement.textContent.replace(/[^0-9]/g, '') || 0);
            const oldPerSecond = parseInt(perSecondElement.textContent.replace(/[^0-9]/g, '') || 0);
            
            diamondElement.textContent = formatNumber(gameState.diamonds);
            perSecondElement.textContent = formatNumber(gameState.perSecond);
            clickValueElement.textContent = formatNumber(gameState.perClick);
            autoClickerElement.textContent = gameState.totalAutoClickers;
            totalClicksElement.textContent = formatNumber(gameState.totalClicks);
            playerLevelElement.textContent = gameState.playerLevel;
            
            // è§¦å‘æ•°å­—åŠ¨ç”»
            animateNumber(diamondElement, gameState.diamonds, oldDiamonds);
            animateNumber(perSecondElement, gameState.perSecond, oldPerSecond);
            
            // æ›´æ–°ç­‰çº§æ˜¾ç¤º
            document.getElementById('currentLevel').textContent = gameState.playerLevel;
            document.getElementById('nextLevel').textContent = gameState.playerLevel + 1;
            
            // æ›´æ–°ç­‰çº§è¿›åº¦æ¡
            const xpForNextLevel = Math.pow(gameState.playerLevel, 2) * 100;
            const xpProgress = (gameState.playerXP % xpForNextLevel) / xpForNextLevel * 100;
            document.getElementById('levelFill').style.width = `${xpProgress}%`;
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStatistics() {
            // æ€»æ¸¸æˆæ—¶é—´
            const totalHours = Math.floor(gameState.totalPlayTime / 3600);
            const totalMinutes = Math.floor((gameState.totalPlayTime % 3600) / 60);
            document.getElementById('totalPlayTime').textContent = `${totalHours}å°æ—¶${totalMinutes}åˆ†`;
            
            // ç‚¹å‡»æ•ˆç‡
            const clicksPerMinute = gameState.totalClicks > 0 ? 
                Math.floor(gameState.totalClicks / (gameState.totalPlayTime / 60)) : 0;
            document.getElementById('clickEfficiency').textContent = `${clicksPerMinute}/åˆ†é’Ÿ`;
            
            // å‡çº§æ€»æ•°
            const totalUpgrades = gameState.upgrades.reduce((sum, upgrade) => sum + upgrade.owned, 0) +
                                gameState.autoClickers.reduce((sum, clicker) => sum + clicker.owned, 0);
            document.getElementById('totalUpgrades').textContent = totalUpgrades;
            
            // çš®è‚¤æ€»æ•°
            const totalSkins = gameState.skins.filter(skin => skin.owned).length;
            document.getElementById('totalSkins').textContent = totalSkins;
            
            // æ›´æ–°æ¸¸æˆç»Ÿè®¡
            gameState.statistics.totalUpgradesBought = totalUpgrades;
            gameState.statistics.totalSkinsUnlocked = totalSkins;
            gameState.statistics.totalAchievements = gameState.achievements.filter(a => a.unlocked).length;
        }
        
        // ============================================
        // äº‹ä»¶å¤„ç†å‡½æ•°
        // ============================================
        
        // å¤„ç†ç‚¹å‡»äº‹ä»¶
        function handleClick(e) {
            if (!gameState.settings.animation) {
                // å¦‚æœåŠ¨ç”»å…³é—­ï¼Œç›´æ¥æ·»åŠ é’»çŸ³
                addDiamondsFromClick();
                return;
            }
            
            const button = e.currentTarget;
            const rect = button.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // æ·»åŠ ç‚¹å‡»ç‰¹æ•ˆ
            createClickEffect(button, x, y);
            
            // å¢åŠ é’»çŸ³
            addDiamondsFromClick();
            
            // æ·»åŠ æŒ‰é’®ç‚¹å‡»åŠ¨ç”»
            button.classList.add('pulse');
            setTimeout(() => {
                button.classList.remove('pulse');
            }, 200);
        }
        
        function addDiamondsFromClick() {
            let diamondsEarned = gameState.perClick;
            
            // å¹¸è¿å®çŸ³æ•ˆæœ
            const luckyUpgrade = gameState.upgrades.find(u => u.id === 4);
            if (luckyUpgrade && luckyUpgrade.owned > 0 && Math.random() < 0.1) {
                diamondsEarned *= 10;
                showNotification('å¹¸è¿å®çŸ³è§¦å‘ï¼è·å¾—10å€æ”¶ç›Šï¼');
            }
            
            // ç‚¹å‡»é£æš´æ•ˆæœ
            const stormUpgrade = gameState.upgrades.find(u => u.id === 5);
            if (stormUpgrade && stormUpgrade.owned > 0 && Math.random() < 0.05) {
                const stormClicks = Math.floor(Math.random() * 5) + 3;
                diamondsEarned *= stormClicks;
                
                showNotification(`ç‚¹å‡»é£æš´ï¼è§¦å‘${stormClicks}è¿å‡»ï¼`);
                
                // æ˜¾ç¤ºé£æš´æ•ˆæœ
                if (gameState.settings.animation) {
                    const button = document.getElementById('clickerButton');
                    for (let i = 0; i < stormClicks; i++) {
                        setTimeout(() => {
                            const x = Math.random() * 200 + 50;
                            const y = Math.random() * 200 + 50;
                            createFloatingDiamond(button, x, y, diamondsEarned / stormClicks);
                        }, i * 50);
                    }
                }
            }
            
            // æš´å‡»ç‚¹å‡»æŠ€èƒ½
            const critSkill = gameState.skills.find(s => s.id === 3);
            if (critSkill && critSkill.active) {
                diamondsEarned *= 100;
                critSkill.active = false;
                showNotification('æš´å‡»ç‚¹å‡»ï¼è·å¾—100å€æ”¶ç›Šï¼');
                renderSkills();
            }
            
            // åº”ç”¨å¢ç›Šæ•ˆæœ
            const activeBoost = gameState.boosts.find(boost => boost.active);
            if (activeBoost && activeBoost.multiplier > 1) {
                diamondsEarned *= activeBoost.multiplier;
            }
            
            // å¹¸è¿æ—¶åˆ»æŠ€èƒ½
            const luckyMomentSkill = gameState.skills.find(s => s.id === 5 && s.active);
            if (luckyMomentSkill) {
                diamondsEarned *= 1.5;
            }
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€
            gameState.diamonds += Math.floor(diamondsEarned);
            gameState.totalClicks++;
            gameState.statistics.totalDiamondsEarned += diamondsEarned;
            gameState.playerXP += diamondsEarned / 500;
            
            // æ›´æ–°æœ€é«˜é’»çŸ³æ•°é‡
            if (gameState.diamonds > gameState.statistics.highestDiamonds) {
                gameState.statistics.highestDiamonds = gameState.diamonds;
            }
            
            // æ›´æ–°ä»»åŠ¡
            updateQuestProgress();
            
            // æ›´æ–°UI
            updateUI();
            renderUpgrades();
            renderAutoClickers();
            renderQuests();
            renderAchievements();
            
            // æ’­æ”¾éŸ³æ•ˆ
            if (gameState.settings.sound) {
                playSoundEffect('click');
            }
        }
        
        // ============================================
        // æ¸²æŸ“å‡½æ•°
        // ============================================
        
        // æ¸²æŸ“å‡çº§é¡¹
        function renderUpgrades() {
            const container = document.getElementById('upgradesList');
            if (!container) return;
            
            container.innerHTML = '';
            
            gameState.upgrades.forEach(upgrade => {
                const canAfford = gameState.diamonds >= upgrade.price;
                const maxed = upgrade.owned >= upgrade.max;
                
                const upgradeElement = document.createElement('div');
                upgradeElement.className = 'upgrade-item';
                upgradeElement.innerHTML = `
                    <div class="upgrade-info">
                        <h4>${upgrade.name} ${upgrade.owned > 0 ? `<span style="color: #4CAF50;">(${upgrade.owned}/${upgrade.max})</span>` : ''}</h4>
                        <p>${upgrade.description}</p>
                    </div>
                    <div>
                        <div class="upgrade-price">
                            <i class="fas fa-gem"></i> ${formatNumber(upgrade.price)}
                        </div>
                        <button class="buy-btn" ${!canAfford || maxed ? 'disabled' : ''}>
                            ${maxed ? 'å·²æ»¡çº§' : canAfford ? 'è´­ä¹°' : 'ä¸è¶³'}
                        </button>
                    </div>
                `;
                
                // æ·»åŠ è´­ä¹°äº‹ä»¶
                if (!maxed) {
                    const buyBtn = upgradeElement.querySelector('.buy-btn');
                    buyBtn.addEventListener('click', () => buyUpgrade(upgrade.id));
                }
                
                container.appendChild(upgradeElement);
            });
        }
        
        // æ¸²æŸ“è‡ªåŠ¨ç‚¹å‡»å™¨
        function renderAutoClickers() {
            const container = document.getElementById('autoClickersList');
            if (!container) return;
            
            container.innerHTML = '';
            
            gameState.autoClickers.forEach(clicker => {
                const canAfford = gameState.diamonds >= clicker.currentPrice;
                
                const clickerElement = document.createElement('div');
                clickerElement.className = 'auto-clicker-item';
                clickerElement.innerHTML = `
                    <div class="auto-clicker-info">
                        <h4>${clicker.name} ${clicker.owned > 0 ? `<span style="color: #4CAF50;">(æ‹¥æœ‰: ${clicker.owned})</span>` : ''}</h4>
                        <p>${clicker.description}</p>
                    </div>
                    <div>
                        <div class="auto-clicker-price">
                            <i class="fas fa-gem"></i> ${formatNumber(clicker.currentPrice)}
                        </div>
                        <button class="buy-btn" ${!canAfford ? 'disabled' : ''}>
                            ${canAfford ? 'è´­ä¹°' : 'ä¸è¶³'}
                        </button>
                    </div>
                `;
                
                const buyBtn = clickerElement.querySelector('.buy-btn');
                buyBtn.addEventListener('click', () => buyAutoClicker(clicker.id));
                
                container.appendChild(clickerElement);
            });
        }
        
        // æ¸²æŸ“çš®è‚¤
        function renderSkins() {
            const container = document.getElementById('skinsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            gameState.skins.forEach(skin => {
                const canAfford = gameState.diamonds >= skin.price || skin.owned;
                const isEquipped = skin.equipped;
                
                const skinElement = document.createElement('div');
                skinElement.className = 'skin-item';
                skinElement.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="skin-preview" style="background: linear-gradient(145deg, ${skin.color1}, ${skin.color2});">
                            <i class="${skin.icon}" style="color: white;"></i>
                        </div>
                        <div class="skin-info">
                            <h4>${skin.name} ${skin.owned ? '<span class="owned-tag">å·²æ‹¥æœ‰</span>' : ''}</h4>
                            <p>${skin.description}</p>
                            ${skin.special ? '<p style="color: #FFD700; font-size: 0.8rem;">ç‰¹åˆ«ç‰ˆçš®è‚¤</p>' : ''}
                        </div>
                    </div>
                    <div>
                        ${skin.owned ? 
                            `<button class="equip-btn ${isEquipped ? 'equipped' : ''}" ${isEquipped ? 'disabled' : ''}>
                                ${isEquipped ? 'å·²è£…å¤‡' : 'è£…å¤‡'}
                            </button>` : 
                            `<div class="skin-price">
                                <i class="fas fa-gem"></i> ${skin.special ? 'ç‰¹æ®Šè·å–' : formatNumber(skin.price)}
                            </div>
                            <button class="buy-btn" ${!canAfford || skin.special ? 'disabled' : ''}>
                                ${skin.special ? 'ç‰¹æ®Šè·å–' : (canAfford ? 'è´­ä¹°' : 'ä¸è¶³')}
                            </button>`
                        }
                    </div>
                `;
                
                if (skin.owned) {
                    const equipBtn = skinElement.querySelector('.equip-btn');
                    if (!isEquipped) {
                        equipBtn.addEventListener('click', () => equipSkin(skin.id));
                    }
                } else if (!skin.special) {
                    const buyBtn = skinElement.querySelector('.buy-btn');
                    buyBtn.addEventListener('click', () => buySkin(skin.id));
                }
                
                container.appendChild(skinElement);
            });
        }
        
        // æ¸²æŸ“å¢ç›Šæ•ˆæœ
        function renderBoosts() {
            const container = document.getElementById('boostsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            gameState.boosts.forEach(boost => {
                const canAfford = gameState.diamonds >= boost.price;
                const isActive = boost.active;
                const timeLeft = boost.endTime - Math.floor(Date.now() / 1000);
                
                const boostElement = document.createElement('div');
                boostElement.className = 'boost-item';
                boostElement.innerHTML = `
                    <div class="boost-info">
                        <h4>${boost.name} ${isActive ? `<span style="color: #4CAF50;">(æ¿€æ´»ä¸­)</span>` : ''}</h4>
                        <p>${boost.description}</p>
                        ${isActive && timeLeft > 0 ? `<p class="skill-cooldown">å‰©ä½™æ—¶é—´: ${formatTime(timeLeft)}</p>` : ''}
                    </div>
                    <div>
                        <div class="boost-price">
                            <i class="fas fa-gem"></i> ${formatNumber(boost.price)}
                        </div>
                        <button class="buy-btn" ${!canAfford || isActive ? 'disabled' : ''}>
                            ${isActive ? 'æ¿€æ´»ä¸­' : (canAfford ? 'æ¿€æ´»' : 'ä¸è¶³')}
                        </button>
                    </div>
                `;
                
                if (!isActive) {
                    const buyBtn = boostElement.querySelector('.buy-btn');
                    buyBtn.addEventListener('click', () => activateBoost(boost.id));
                }
                
                container.appendChild(boostElement);
            });
        }
        
        // æ¸²æŸ“æŠ€èƒ½
        function renderSkills() {
            const container = document.getElementById('skillsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            gameState.skills.forEach(skill => {
                const now = Math.floor(Date.now() / 1000);
                const cooldownLeft = skill.lastUsed + skill.cooldown - now;
                const isReady = cooldownLeft <= 0;
                const isActive = skill.active;
                
                const skillElement = document.createElement('div');
                skillElement.className = 'skill-item';
                skillElement.innerHTML = `
                    <div class="skill-info">
                        <h4>${skill.name} ${isActive ? `<span style="color: #FF5722;">(æ¿€æ´»ä¸­)</span>` : ''}</h4>
                        <p>${skill.description}</p>
                        ${!isReady && !isActive ? `<p class="skill-cooldown">å†·å´æ—¶é—´: ${formatTime(cooldownLeft)}</p>` : ''}
                    </div>
                    <div>
                        <button class="skill-use-btn" ${!isReady || isActive ? 'disabled' : ''}>
                            ${isActive ? 'æ¿€æ´»ä¸­' : (isReady ? 'ä½¿ç”¨' : 'å†·å´ä¸­')}
                        </button>
                    </div>
                `;
                
                if (isReady && !isActive) {
                    const useBtn = skillElement.querySelector('.skill-use-btn');
                    useBtn.addEventListener('click', () => useSkill(skill.id));
                }
                
                container.appendChild(skillElement);
            });
        }
        
        // æ¸²æŸ“ä»»åŠ¡
        function renderQuests() {
            const container = document.getElementById('questsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            gameState.quests.forEach(quest => {
                const progressPercent = (quest.progress / quest.goal) * 100;
                const canClaim = quest.completed && !quest.claimed;
                
                const questElement = document.createElement('div');
                questElement.className = 'quest-item';
                questElement.innerHTML = `
                    <div class="quest-info">
                        <h4>${quest.name} ${quest.claimed ? `<span style="color: #4CAF50;">(å·²é¢†å–)</span>` : ''}</h4>
                        <p>${quest.description}</p>
                        <div class="achievement-progress">
                            <div class="progress-bar" style="width: ${Math.min(progressPercent, 100)}%"></div>
                        </div>
                        <p style="margin-top: 5px; font-size: 0.8rem;">
                            è¿›åº¦: ${quest.progress}/${quest.goal}
                        </p>
                    </div>
                    <div>
                        <div class="quest-reward">
                            <i class="fas fa-gem"></i> ${formatNumber(quest.reward)}
                        </div>
                        <button class="quest-claim-btn" ${!canClaim ? 'disabled' : ''}>
                            ${quest.claimed ? 'å·²é¢†å–' : (canClaim ? 'é¢†å–' : 'æœªå®Œæˆ')}
                        </button>
                    </div>
                `;
                
                if (canClaim) {
                    const claimBtn = questElement.querySelector('.quest-claim-btn');
                    claimBtn.addEventListener('click', () => claimQuestReward(quest.id));
                }
                
                container.appendChild(questElement);
            });
        }
        
        // æ¸²æŸ“æˆå°±
        function renderAchievements() {
            const container = document.getElementById('achievementsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            gameState.achievements.forEach(achievement => {
                const progressPercent = (achievement.progress / achievement.goal) * 100;
                const isUnlocked = achievement.unlocked;
                
                const achievementElement = document.createElement('div');
                achievementElement.className = `achievement ${isUnlocked ? 'unlocked' : ''}`;
                achievementElement.innerHTML = `
                    <div class="achievement-icon">
                        <i class="fas fa-${isUnlocked ? 'trophy' : 'lock'}"></i>
                    </div>
                    <div class="achievement-info">
                        <h4>${achievement.name} ${isUnlocked ? '<span style="color: #4CAF50;">(å·²è§£é”)</span>' : ''}</h4>
                        <p>${achievement.description}</p>
                        <div class="achievement-progress">
                            <div class="progress-bar" style="width: ${Math.min(progressPercent, 100)}%"></div>
                        </div>
                        <p style="margin-top: 5px; font-size: 0.8rem;">
                            è¿›åº¦: ${achievement.progress}/${achievement.goal}
                            ${isUnlocked ? `<span style="color: #FFD700; margin-left: 10px;">å¥–åŠ±: ${formatNumber(achievement.reward)}ğŸ’</span>` : ''}
                        </p>
                    </div>
                `;
                
                container.appendChild(achievementElement);
            });
        }
        
        // æ¸²æŸ“è½¬ç›˜
        function renderWheel() {
            const wheel = document.getElementById('wheelCircle');
            if (!wheel) return;
            
            wheel.innerHTML = '';
            
            const segmentAngle = 360 / wheelPrizes.length;
            
            wheelPrizes.forEach((prize, index) => {
                const segment = document.createElement('div');
                segment.className = 'wheel-segment';
                segment.style.transform = `rotate(${index * segmentAngle}deg)`;
                segment.style.backgroundColor = prize.color;
                
                const text = document.createElement('div');
                text.style.transform = `rotate(${segmentAngle/2}deg)`;
                text.style.textAlign = 'center';
                text.style.width = '100%';
                text.style.paddingLeft = '20px';
                text.style.fontSize = '14px';
                text.textContent = prize.name;
                
                segment.appendChild(text);
                wheel.appendChild(segment);
            });
            
            // æ›´æ–°è½¬ç›˜æŒ‰é’®çŠ¶æ€
            updateWheelButton();
        }
        
        // æ¸²æŸ“æ’è¡Œæ¦œ
        function renderLeaderboard() {
            const container = document.getElementById('leaderboardBody');
            if (!container) return;
            
            container.innerHTML = '';
            
            // æ›´æ–°å½“å‰ç©å®¶æ•°æ®
            updateLeaderboardPlayerData();
            
            // æŒ‰é’»çŸ³æ•°é‡æ’åº
            const sortedLeaderboard = [...leaderboardData].sort((a, b) => b.diamonds - a.diamonds);
            
            // æ·»åŠ å½“å‰ç©å®¶åˆ°æ’è¡Œæ¦œ
            const currentPlayer = {
                rank: 0,
                name: gameState.playerName,
                diamonds: gameState.diamonds,
                clicks: gameState.totalClicks,
                level: gameState.playerLevel
            };
            
            sortedLeaderboard.push(currentPlayer);
            sortedLeaderboard.sort((a, b) => b.diamonds - a.diamonds);
            
            // æ›´æ–°æ’å
            sortedLeaderboard.forEach((player, index) => {
                player.rank = index + 1;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="rank-${player.rank}">${player.rank}</td>
                    <td>${player.name}</td>
                    <td>${formatNumber(player.diamonds)}</td>
                    <td>${formatNumber(player.clicks)}</td>
                    <td>${player.level}</td>
                `;
                
                container.appendChild(row);
            });
        }
        
        // ============================================
        // æ¸¸æˆé€»è¾‘å‡½æ•°
        // ============================================
        
        // è´­ä¹°å‡çº§
        function buyUpgrade(upgradeId) {
            const upgrade = gameState.upgrades.find(u => u.id === upgradeId);
            
            if (!upgrade || upgrade.owned >= upgrade.max || gameState.diamonds < upgrade.price) {
                return;
            }
            
            // æ‰£é™¤é’»çŸ³
            gameState.diamonds -= upgrade.price;
            
            // å¢åŠ å‡çº§
            upgrade.owned++;
            
            // åº”ç”¨å‡çº§æ•ˆæœ
            if (upgrade.increase > 0) {
                gameState.perClick += upgrade.increase;
            }
            
            // æé«˜ä»·æ ¼
            upgrade.price = Math.floor(upgrade.price * 1.5);
            
            // é‡æ–°è®¡ç®—æ¯ç§’æ”¶ç›Š
            calculatePerSecond();
            
            // æ›´æ–°UI
            updateUI();
            renderUpgrades();
            renderQuests();
            renderAchievements();
            
            // æ’­æ”¾éŸ³æ•ˆ
            if (gameState.settings.sound) {
                playSoundEffect('buy');
            }
        }
        
        // è´­ä¹°è‡ªåŠ¨ç‚¹å‡»å™¨
        function buyAutoClicker(clickerId) {
            const clicker = gameState.autoClickers.find(c => c.id === clickerId);
            
            if (!clicker || gameState.diamonds < clicker.currentPrice) {
                return;
            }
            
            // æ‰£é™¤é’»çŸ³
            gameState.diamonds -= clicker.currentPrice;
            
            // å¢åŠ è‡ªåŠ¨ç‚¹å‡»å™¨
            clicker.owned++;
            
            // æé«˜ä»·æ ¼
            clicker.currentPrice = Math.floor(clicker.currentPrice * 1.8);
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            gameState.statistics.totalUpgradesBought++;
            
            // é‡æ–°è®¡ç®—æ¯ç§’æ”¶ç›Š
            calculatePerSecond();
            
            // æ›´æ–°UI
            updateUI();
            renderAutoClickers();
            renderQuests();
            renderAchievements();
            
            // æ’­æ”¾éŸ³æ•ˆ
            if (gameState.settings.sound) {
                playSoundEffect('buy');
            }
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(`è´­ä¹°äº†${clicker.name}ï¼`);
        }
        
        // è´­ä¹°çš®è‚¤
        function buySkin(skinId) {
            const skin = gameState.skins.find(s => s.id === skinId);
            
            if (!skin || skin.owned || gameState.diamonds < skin.price) {
                return;
            }
            
            // æ‰£é™¤é’»çŸ³
            gameState.diamonds -= skin.price;
            
            // è·å¾—çš®è‚¤
            skin.owned = true;
            
            // è‡ªåŠ¨è£…å¤‡çš®è‚¤
            equipSkin(skinId);
            
            // æ›´æ–°UI
            updateUI();
            renderSkins();
            renderQuests();
            renderAchievements();
            
            // æ’­æ”¾éŸ³æ•ˆ
            if (gameState.settings.sound) {
                playSoundEffect('skin');
            }
        }
        
        // è£…å¤‡çš®è‚¤
        function equipSkin(skinId) {
            const skin = gameState.skins.find(s => s.id === skinId);
            
            if (!skin || !skin.owned) {
                return;
            }
            
            // å–æ¶ˆè£…å¤‡å…¶ä»–çš®è‚¤
            gameState.skins.forEach(s => {
                s.equipped = false;
            });
            
            // è£…å¤‡æ–°çš®è‚¤
            skin.equipped = true;
            gameState.selectedSkin = skin.name;
            
            // æ›´æ–°ä¸»æŒ‰é’®å¤–è§‚
            const mainGem = document.getElementById('mainGem');
            const clickerButton = document.getElementById('clickerButton');
            
            if (mainGem && clickerButton) {
                mainGem.className = skin.icon;
                clickerButton.style.background = `linear-gradient(145deg, ${skin.color1}, ${skin.color2})`;
            }
            
            // æ›´æ–°UI
            renderSkins();
            
            // æ’­æ”¾éŸ³æ•ˆ
            if (gameState.settings.sound) {
                playSoundEffect('equip');
            }
        }
        
        // æ¿€æ´»å¢ç›Šæ•ˆæœ
        function activateBoost(boostId) {
            const boost = gameState.boosts.find(b => b.id === boostId);
            
            if (!boost || boost.active || gameState.diamonds < boost.price) {
                return;
            }
            
            // æ‰£é™¤é’»çŸ³
            gameState.diamonds -= boost.price;
            
            // æ¿€æ´»å¢ç›Š
            boost.active = true;
            boost.endTime = Math.floor(Date.now() / 1000) + boost.duration;
            
            // é‡æ–°è®¡ç®—æ¯ç§’æ”¶ç›Š
            calculatePerSecond();
            
            // æ›´æ–°UI
            updateUI();
            renderBoosts();
            
            // æ’­æ”¾éŸ³æ•ˆ
            if (gameState.settings.sound) {
                playSoundEffect('boost');
            }
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(`å·²æ¿€æ´»${boost.name}å¢ç›Šæ•ˆæœï¼`);
        }
        
        // ä½¿ç”¨æŠ€èƒ½
        function useSkill(skillId) {
            const skill = gameState.skills.find(s => s.id === skillId);
            const now = Math.floor(Date.now() / 1000);
            
            if (!skill || skill.lastUsed + skill.cooldown > now) {
                return;
            }
            
            // è®¾ç½®æœ€åä½¿ç”¨æ—¶é—´
            skill.lastUsed = now;
            
            // åº”ç”¨æŠ€èƒ½æ•ˆæœ
            switch(skill.id) {
                case 1: // é’»çŸ³é£æš´
                    gameState.diamonds += 1000;
                    showNotification('é’»çŸ³é£æš´ï¼è·å¾—1000é’»çŸ³');
                    break;
                case 2: // æ—¶é—´åŠ é€Ÿ
                    skill.active = true;
                    skill.endTime = now + 30;
                    
                    // 5å€è‡ªåŠ¨ç‚¹å‡»å™¨é€Ÿåº¦
                    const originalPerSecond = gameState.perSecond;
                    gameState.perSecond *= 5;
                    
                    // 30ç§’åæ¢å¤
                    setTimeout(() => {
                        skill.active = false;
                        gameState.perSecond = originalPerSecond;
                        renderSkills();
                        updateUI();
                    }, 30000);
                    
                    showNotification('æ—¶é—´åŠ é€Ÿï¼è‡ªåŠ¨ç‚¹å‡»å™¨é€Ÿåº¦æé«˜5å€ï¼ŒæŒç»­30ç§’');
                    break;
                case 3: // æš´å‡»ç‚¹å‡»
                    skill.active = true;
                    showNotification('ä¸‹ä¸€æ¬¡ç‚¹å‡»å°†è·å¾—100å€æ”¶ç›Šï¼');
                    break;
                case 4: // å¬å”¤æœºå™¨äºº
                    // éšæœºè·å¾—ä¸€ä¸ªè‡ªåŠ¨ç‚¹å‡»å™¨
                    const randomClicker = autoClickersData[Math.floor(Math.random() * 3) + 2]; // è·å–2-4çº§çš„è‡ªåŠ¨ç‚¹å‡»å™¨
                    const clickerIndex = randomClicker.id - 1;
                    
                    if (!gameState.autoClickers[clickerIndex]) {
                        gameState.autoClickers[clickerIndex] = { ...autoClickersData[clickerIndex] };
                    }
                    gameState.autoClickers[clickerIndex].owned++;
                    
                    calculatePerSecond();
                    renderAutoClickers();
                    updateUI();
                    
                    showNotification(`å¬å”¤æœºå™¨äººï¼è·å¾—ä¸€ä¸ª${randomClicker.name}`);
                    break;
                case 5: // å¹¸è¿æ—¶åˆ»
                    skill.active = true;
                    skill.endTime = now + 60;
                    
                    // å¢åŠ 50%æ”¶ç›Š
                    gameState.perClick = Math.floor(gameState.perClick * 1.5);
                    calculatePerSecond();
                    
                    // 60ç§’åæ¢å¤
                    setTimeout(() => {
                        skill.active = false;
                        gameState.perClick = Math.floor(gameState.perClick / 1.5);
                        calculatePerSecond();
                        renderSkills();
                        updateUI();
                    }, 60000);
                    
                    showNotification('å¹¸è¿æ—¶åˆ»ï¼æ‰€æœ‰æ”¶ç›Šå¢åŠ 50%ï¼ŒæŒç»­60ç§’');
                    break;
            }
            
            // æ›´æ–°UI
            updateUI();
            renderSkills();
            
            // æ’­æ”¾éŸ³æ•ˆ
            if (gameState.settings.sound) {
                playSoundEffect('skill');
            }
        }
        
        // é¢†å–ä»»åŠ¡å¥–åŠ±
        function claimQuestReward(questId) {
            const quest = gameState.quests.find(q => q.id === questId);
            
            if (!quest || !quest.completed || quest.claimed) {
                return;
            }
            
            // æ ‡è®°ä¸ºå·²é¢†å–
            quest.claimed = true;
            
            // å‘æ”¾å¥–åŠ±
            gameState.diamonds += quest.reward;
            
            // æ›´æ–°UI
            updateUI();
            renderQuests();
            renderAchievements();
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(`å®Œæˆä»»åŠ¡ã€${quest.name}ã€‘! è·å¾—${quest.reward}é’»çŸ³`);
            
            // æ’­æ”¾éŸ³æ•ˆ
            if (gameState.settings.sound) {
                playSoundEffect('quest');
            }
        }
        
        // ============================================
        // ç‰¹æ®ŠåŠŸèƒ½å‡½æ•°
        // ============================================
        
        // è½¬ç›˜æŠ½å¥–
        function spinWheel() {
            if (gameState.wheelSpinning) return;
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å…è´¹æŠ½å¥–
            let usingFreeSpin = false;
            if (gameState.freeSpins > 0) {
                usingFreeSpin = true;
                gameState.freeSpins--;
            } else if (gameState.diamonds >= 500) {
                gameState.diamonds -= 500;
            } else {
                showNotification('é’»çŸ³ä¸è¶³ï¼');
                return;
            }
            
            gameState.wheelSpinning = true;
            
            // æ›´æ–°è½¬ç›˜ä»»åŠ¡è¿›åº¦
            const wheelQuest = gameState.quests.find(q => q.id === 8);
            if (wheelQuest) {
                wheelQuest.progress++;
                updateQuestProgress();
            }
            
            // éšæœºé€‰æ‹©å¥–å“
            let random = Math.random() * 100;
            let selectedPrizeIndex = 0;
            
            for (let i = 0; i < wheelPrizes.length; i++) {
                if (random < wheelPrizes[i].probability) {
                    selectedPrizeIndex = i;
                    break;
                }
                random -= wheelPrizes[i].probability;
            }
            
            const selectedPrize = wheelPrizes[selectedPrizeIndex];
            const segmentAngle = 360 / wheelPrizes.length;
            
            // è®¡ç®—æ—‹è½¬è§’åº¦
            const rotations = 5;
            const targetAngle = 360 * rotations + (360 - (selectedPrizeIndex * segmentAngle + segmentAngle/2));
            
            // æ—‹è½¬è½¬ç›˜
            const wheel = document.getElementById('wheelCircle');
            wheel.style.transition = 'transform 4s cubic-bezier(0.17, 0.67, 0.83, 0.67)';
            wheel.style.transform = `rotate(${targetAngle}deg)`;
            
            // ç¦ç”¨æŒ‰é’®
            document.getElementById('wheelSpinBtn').disabled = true;
            document.getElementById('spinWheel').style.pointerEvents = 'none';
            
            setTimeout(() => {
                gameState.wheelSpinning = false;
                
                // å‘æ”¾å¥–å“
                let prizeText = '';
                if (typeof selectedPrize.value === 'number') {
                    gameState.diamonds += selectedPrize.value;
                    prizeText = `æ­å–œè·å¾— ${selectedPrize.name}!`;
                } else if (selectedPrize.value === 'upgrade') {
                    const availableUpgrades = gameState.upgrades.filter(u => u.owned < u.max);
                    if (availableUpgrades.length > 0) {
                        const randomUpgrade = availableUpgrades[Math.floor(Math.random() * availableUpgrades.length)];
                        randomUpgrade.owned++;
                        if (randomUpgrade.increase > 0) {
                            gameState.perClick += randomUpgrade.increase;
                        }
                        prizeText = `æ­å–œè·å¾—å…è´¹å‡çº§: ${randomUpgrade.name}!`;
                        calculatePerSecond();
                        renderUpgrades();
                    } else {
                        gameState.diamonds += 5000;
                        prizeText = `æ­å–œè·å¾— 5000é’»çŸ³ (æ›¿ä»£å‡çº§å¥–åŠ±)!`;
                    }
                } else if (selectedPrize.value === 'skin') {
                    const availableSkins = gameState.skins.filter(s => !s.owned && !s.special && s.id !== 1);
                    if (availableSkins.length > 0) {
                        const randomSkin = availableSkins[Math.floor(Math.random() * availableSkins.length)];
                        randomSkin.owned = true;
                        prizeText = `æ­å–œè·å¾—å…è´¹çš®è‚¤: ${randomSkin.name}!`;
                        renderSkins();
                    } else {
                        gameState.diamonds += 10000;
                        prizeText = `æ­å–œè·å¾— 10000é’»çŸ³ (æ›¿ä»£çš®è‚¤å¥–åŠ±)!`;
                    }
                } else if (selectedPrize.value === 'mystery') {
                    const mysteryReward = 50000 + Math.floor(Math.random() * 50000);
                    gameState.diamonds += mysteryReward;
                    prizeText = `æ­å–œè·å¾—ç¥ç§˜å¤§å¥–: ${formatNumber(mysteryReward)}é’»çŸ³!`;
                }
                
                document.getElementById('wheelResult').textContent = prizeText;
                
                // æ›´æ–°UI
                updateUI();
                updateWheelButton();
                
                // æ˜¾ç¤ºé€šçŸ¥
                showNotification(prizeText);
                
                // æ’­æ”¾éŸ³æ•ˆ
                if (gameState.settings.sound) {
                    playSoundEffect('upgrade');
                }
                
                // 5ç§’åé‡ç½®
                setTimeout(() => {
                    if (!gameState.wheelSpinning) {
                        document.getElementById('wheelResult').textContent = 
                            usingFreeSpin ? 
                            `å…è´¹æŠ½å¥–å‰©ä½™: ${gameState.freeSpins}` : 
                            "èŠ±è´¹500é’»çŸ³æŠ½å¥–";
                    }
                }, 5000);
                
                // é‡ç½®è½¬ç›˜ä½ç½®
                setTimeout(() => {
                    wheel.style.transition = 'none';
                    wheel.style.transform = `rotate(${targetAngle % 360}deg)`;
                    
                    // å¼ºåˆ¶é‡æ’
                    void wheel.offsetWidth;
                    
                    // å¹³æ»‘è½¬å›0åº¦
                    wheel.style.transition = 'transform 2s ease-out';
                    wheel.style.transform = `rotate(0deg)`;
                    
                    // é‡æ–°å¯ç”¨æŒ‰é’®
                    setTimeout(() => {
                        document.getElementById('wheelSpinBtn').disabled = false;
                        document.getElementById('spinWheel').style.pointerEvents = 'auto';
                    }, 2000);
                    
                }, 4000);
                
            }, 4000);
            
            updateWheelButton();
        }
        
        // ============================================
        // ç³»ç»ŸåŠŸèƒ½å‡½æ•°
        // ============================================
        
        // åŠ è½½ç•Œé¢æ§åˆ¶
        function showLoadingScreen() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoadingScreen() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            loadingOverlay.style.opacity = '0';
            loadingOverlay.style.transition = 'opacity 0.5s ease';
            
            setTimeout(() => {
                loadingOverlay.style.display = 'none';
            }, 500);
        }

        function updateLoadingProgress(percent) {
            const progressElement = document.getElementById('loadingProgress');
            if (progressElement) {
                progressElement.textContent = `${percent}%`;
            }
        }
        
        // æ–°æ‰‹å¼•å¯¼ç³»ç»Ÿ
        let currentTutorialStep = 1;

        function showTutorial() {
            document.getElementById('tutorialOverlay').style.display = 'flex';
        }

        function nextTutorialStep() {
            const currentStep = document.getElementById(`tutorialStep${currentTutorialStep}`);
            const nextStep = document.getElementById(`tutorialStep${currentTutorialStep + 1}`);
            
            if (currentStep && nextStep) {
                currentStep.classList.remove('active');
                nextStep.classList.add('active');
                currentTutorialStep++;
            }
        }

        function prevTutorialStep() {
            if (currentTutorialStep > 1) {
                const currentStep = document.getElementById(`tutorialStep${currentTutorialStep}`);
                const prevStep = document.getElementById(`tutorialStep${currentTutorialStep - 1}`);
                
                if (currentStep && prevStep) {
                    currentStep.classList.remove('active');
                    prevStep.classList.add('active');
                    currentTutorialStep--;
                }
            }
        }

        function completeTutorial() {
            gameState.tutorialCompleted = true;
            document.getElementById('tutorialOverlay').style.display = 'none';
            saveGameState();
            
            // ç»™äºˆæ–°æ‰‹å¥–åŠ±
            gameState.diamonds += 1000;
            updateUI();
            showNotification('æ–°æ‰‹æ•™ç¨‹å®Œæˆï¼è·å¾—1000é’»çŸ³å¥–åŠ±ï¼');
        }
        
        // ç¦»çº¿æ”¶ç›Šç³»ç»Ÿ
        function checkOfflineEarnings() {
            if (!gameState.settings.offlineEarnings) return;
            
            const lastSaveTime = gameState.lastSaveTime;
            const currentTime = Date.now();
            const offlineTime = Math.floor((currentTime - lastSaveTime) / 1000); // è½¬æ¢ä¸ºç§’
            
            if (offlineTime > 60) { // ç¦»çº¿è¶…è¿‡1åˆ†é’Ÿ
                const hours = Math.floor(offlineTime / 3600);
                const minutes = Math.floor((offlineTime % 3600) / 60);
                
                // é™åˆ¶æœ€å¤§ç¦»çº¿æ—¶é—´
                const maxOfflineSeconds = GAME_CONFIG.maxOfflineHours * 3600;
                const effectiveOfflineTime = Math.min(offlineTime, maxOfflineSeconds);
                
                // è®¡ç®—ç¦»çº¿æ”¶ç›Š
                const offlineEarnings = Math.floor(gameState.perSecond * effectiveOfflineTime * GAME_CONFIG.offlineMultiplier);
                
                if (offlineEarnings > 0) {
                    gameState.offlineEarnings = {
                        time: offlineTime,
                        hours: hours,
                        minutes: minutes,
                        earnings: offlineEarnings
                    };
                    
                    showOfflineEarnings(offlineTime, offlineEarnings);
                }
            }
        }

        function showOfflineEarnings(offlineTime, earnings) {
            const offlineElement = document.getElementById('offlineEarnings');
            const timeElement = document.getElementById('offlineTime');
            const rewardElement = document.getElementById('offlineReward');
            
            const hours = Math.floor(offlineTime / 3600);
            const minutes = Math.floor((offlineTime % 3600) / 60);
            
            timeElement.textContent = `ç¦»çº¿æ—¶é—´: ${hours}å°æ—¶${minutes}åˆ†é’Ÿ`;
            rewardElement.textContent = `è·å¾—é’»çŸ³: ${formatNumber(earnings)}`;
            
            offlineElement.style.display = 'block';
        }

        function claimOfflineEarnings() {
            if (gameState.offlineEarnings) {
                const earnings = gameState.offlineEarnings.earnings;
                gameState.diamonds += earnings;
                gameState.statistics.totalDiamondsEarned += earnings;
                
                // æ›´æ–°UI
                updateUI();
                
                // éšè—ç¦»çº¿æ”¶ç›Šæç¤º
                document.getElementById('offlineEarnings').style.display = 'none';
                
                // æ˜¾ç¤ºé€šçŸ¥
                showNotification(`é¢†å–ç¦»çº¿æ”¶ç›Š: ${formatNumber(earnings)}é’»çŸ³ï¼`);
                
                // æ¸…é™¤ç¦»çº¿æ”¶ç›Šæ•°æ®
                gameState.offlineEarnings = null;
                
                // æ’­æ”¾éŸ³æ•ˆ
                if (gameState.settings.sound) {
                    playSoundEffect('recharge');
                }
            }
        }
        
        // è®¾ç½®ç³»ç»Ÿ
        function setupSettings() {
            // éŸ³æ•ˆå¼€å…³
            const soundToggle = document.getElementById('soundToggle');
            if (soundToggle) {
                soundToggle.checked = gameState.settings.sound;
                soundToggle.addEventListener('change', (e) => {
                    gameState.settings.sound = e.target.checked;
                    saveGameState();
                });
            }
            
            // åŠ¨ç”»å¼€å…³
            const animationToggle = document.getElementById('animationToggle');
            if (animationToggle) {
                animationToggle.checked = gameState.settings.animation;
                animationToggle.addEventListener('change', (e) => {
                    gameState.settings.animation = e.target.checked;
                    saveGameState();
                });
            }
            
            // ç¦»çº¿æ”¶ç›Šå¼€å…³
            const offlineToggle = document.getElementById('offlineEarningsToggle');
            if (offlineToggle) {
                offlineToggle.checked = gameState.settings.offlineEarnings;
                offlineToggle.addEventListener('change', (e) => {
                    gameState.settings.offlineEarnings = e.target.checked;
                    saveGameState();
                });
            }
            
            // è‡ªåŠ¨ä¿å­˜å¼€å…³
            const autoSaveToggle = document.getElementById('autoSaveToggle');
            if (autoSaveToggle) {
                autoSaveToggle.checked = gameState.settings.autoSave;
                autoSaveToggle.addEventListener('change', (e) => {
                    gameState.settings.autoSave = e.target.checked;
                    saveGameState();
                });
            }
        }
        
        // æ¸¸æˆå­˜æ¡£ç®¡ç†
        function exportSave() {
            const saveData = JSON.stringify(gameState);
            const blob = new Blob([saveData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `é’»çŸ³ç‹‚çƒ­è€…å­˜æ¡£_${new Date().toLocaleDateString()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('å­˜æ¡£å·²å¯¼å‡ºï¼');
        }

        function importSave() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = (event) => {
                    try {
                        const saveData = JSON.parse(event.target.result);
                        
                        // éªŒè¯å­˜æ¡£æ•°æ®
                        if (saveData.diamonds !== undefined && saveData.upgrades) {
                            if (confirm('ç¡®å®šè¦åŠ è½½è¿™ä¸ªå­˜æ¡£å—ï¼Ÿå½“å‰è¿›åº¦å°†ä¼šä¸¢å¤±ã€‚')) {
                                localStorage.setItem('diamondManiacGame', JSON.stringify(saveData));
                                location.reload();
                            }
                        } else {
                            alert('å­˜æ¡£æ–‡ä»¶æ— æ•ˆï¼');
                        }
                    } catch (error) {
                        alert('è¯»å–å­˜æ¡£æ–‡ä»¶å¤±è´¥ï¼');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function resetGame() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ¸¸æˆå—ï¼Ÿæ‰€æœ‰è¿›åº¦å°†ä¼šä¸¢å¤±ï¼')) {
                localStorage.removeItem('diamondManiacGame');
                location.reload();
            }
        }
        
        // å……å€¼ç³»ç»Ÿ
        function openRechargeModal() {
            const modal = document.getElementById('rechargeModal');
            const amountText = document.getElementById('rechargeAmountText');
            const paymentStatus = document.getElementById('paymentStatus');
            const { amount, price } = gameState.selectedRechargeOption;
            
            amountText.textContent = `å……å€¼é‡‘é¢ï¼šï¿¥${price}ï¼Œè·å¾—${formatNumber(amount)}é’»çŸ³`;
            paymentStatus.className = 'payment-status';
            paymentStatus.textContent = '';
            paymentStatus.style.display = 'none';
            
            modal.style.display = 'flex';
            
            // åˆ›å»ºå¾…å¤„ç†æ”¯ä»˜
            gameState.pendingPayment = {
                amount: amount,
                price: price,
                timestamp: Date.now(),
                status: 'pending'
            };
        }

        function closeRechargeModal() {
            document.getElementById('rechargeModal').style.display = 'none';
            gameState.pendingPayment = null;
        }

        function checkPaymentStatus() {
            if (!gameState.pendingPayment) return;
            
            const paymentStatus = document.getElementById('paymentStatus');
            
            // æ¨¡æ‹Ÿæ”¯ä»˜æ£€æŸ¥ - åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥è¿æ¥åç«¯æœåŠ¡å™¨éªŒè¯æ”¯ä»˜
            // è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªéšæœºç»“æœï¼š70%å‡ ç‡æ”¯ä»˜æˆåŠŸï¼Œ20%å‡ ç‡æ”¯ä»˜ä¸­ï¼Œ10%å‡ ç‡æ”¯ä»˜å¤±è´¥
            const random = Math.random();
            
            if (random < 0.7) {
                // æ”¯ä»˜æˆåŠŸ
                paymentStatus.className = 'payment-status success';
                paymentStatus.innerHTML = '<i class="fas fa-check-circle"></i> æ”¯ä»˜æˆåŠŸï¼é’»çŸ³å·²åˆ°è´¦';
                paymentStatus.style.display = 'block';
                
                // å‘æ”¾é’»çŸ³
                confirmRecharge();
                
                // 3ç§’åå…³é—­æ¨¡æ€æ¡†
                setTimeout(() => {
                    closeRechargeModal();
                }, 3000);
            } else if (random < 0.9) {
                // æ”¯ä»˜ä¸­
                paymentStatus.className = 'payment-status pending';
                paymentStatus.innerHTML = '<i class="fas fa-clock"></i> æ”¯ä»˜å¤„ç†ä¸­ï¼Œè¯·ç¨åå†è¯•';
                paymentStatus.style.display = 'block';
            } else {
                // æ”¯ä»˜å¤±è´¥
                paymentStatus.className = 'payment-status failed';
                paymentStatus.innerHTML = '<i class="fas fa-times-circle"></i> æ”¯ä»˜å¤±è´¥ï¼Œè¯·é‡è¯•æˆ–è”ç³»å®¢æœ';
                paymentStatus.style.display = 'block';
            }
        }

        function confirmRecharge() {
            if (!gameState.pendingPayment) return;
            
            const { amount } = gameState.pendingPayment;
            
            // å¢åŠ é’»çŸ³
            gameState.diamonds += amount;
            
            // æ›´æ–°å……å€¼ç›¸å…³æˆå°±
            const rechargeAchievement1 = gameState.achievements.find(a => a.id === 17); // VIPç©å®¶
            if (rechargeAchievement1) {
                rechargeAchievement1.progress = 1;
            }
            
            const rechargeAchievement2 = gameState.achievements.find(a => a.id === 18); // å¤§å®¢æˆ·
            if (rechargeAchievement2) {
                // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…åº”è¯¥ç´¯è®¡å……å€¼é‡‘é¢
                rechargeAchievement2.progress += gameState.pendingPayment.price;
            }
            
            // æ›´æ–°UI
            updateUI();
            renderAchievements();
            
            // æ˜¾ç¤ºå……å€¼æˆåŠŸæ¶ˆæ¯
            showNotification(`å……å€¼æˆåŠŸ! è·å¾—${formatNumber(amount)}é’»çŸ³`);
            
            // æ’­æ”¾éŸ³æ•ˆ
            if (gameState.settings.sound) {
                playSoundEffect('recharge');
            }
        }
        
        // ============================================
        // è¾…åŠ©åŠŸèƒ½å‡½æ•°
        // ============================================
        
        // åˆ›å»ºæµ®åŠ¨é’»çŸ³æ•ˆæœ
        function createFloatingDiamond(button, x, y, amount) {
            if (!gameState.settings.animation) return;
            
            const diamond = document.createElement('div');
            diamond.className = 'floating-diamond';
            diamond.textContent = `+${formatNumber(amount)}`;
            diamond.style.left = `${x}px`;
            diamond.style.top = `${y}px`;
            
            button.appendChild(diamond);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
            setTimeout(() => {
                diamond.remove();
            }, 1000);
        }
        
        // åˆ›å»ºç‚¹å‡»ç‰¹æ•ˆ
        function createClickEffect(button, x, y) {
            if (!gameState.settings.animation) return;
            
            // åˆ›å»ºæ¶Ÿæ¼ªæ•ˆæœ
            const ripple = document.createElement('div');
            ripple.className = 'ripple';
            ripple.style.left = `${x}px`;
            ripple.style.top = `${y}px`;
            button.appendChild(ripple);
            
            setTimeout(() => {
                ripple.remove();
            }, 600);
            
            // åˆ›å»ºæµ®åŠ¨é’»çŸ³
            createFloatingDiamond(button, x, y, gameState.perClick);
        }
        
        // æ•°å­—åŠ¨ç”»æ•ˆæœ
        function animateNumber(element, newValue, oldValue) {
            if (!gameState.settings.animation || newValue === oldValue) return;
            
            element.classList.add('stat-increasing');
            setTimeout(() => {
                element.classList.remove('stat-increasing');
            }, 300);
        }
        
        // æ˜¾ç¤ºä¿å­˜æç¤º
        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.style.display = 'block';
            
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 2000);
        }
        
        // éŸ³æ•ˆç³»ç»Ÿ
        function playSoundEffect(type) {
            if (!gameState.settings.sound) return;
            
            try {
                // åˆ›å»ºç®€å•çš„éŸ³æ•ˆ
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                switch(type) {
                    case 'click':
                        playClickSound(audioContext);
                        break;
                    case 'buy':
                        playBuySound(audioContext);
                        break;
                    case 'upgrade':
                        playUpgradeSound(audioContext);
                        break;
                    case 'achievement':
                        playAchievementSound(audioContext);
                        break;
                    default:
                        // é»˜è®¤éŸ³æ•ˆ
                        playDefaultSound(audioContext);
                }
            } catch (error) {
                console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', error);
            }
        }

        function playClickSound(audioContext) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        function playBuySound(audioContext) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 1200;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }
        
        // ============================================
        // æ›´æ–°å‡½æ•°
        // ============================================
        
        // æ›´æ–°ä»»åŠ¡è¿›åº¦
        function updateQuestProgress() {
            let changed = false;
            
            // æ›´æ–°ç‚¹å‡»ä»»åŠ¡
            gameState.quests[0].progress = gameState.totalClicks; // é¦–æ¬¡ç‚¹å‡»
            gameState.quests[6].progress = gameState.totalClicks; // ç‚¹å‡»ç‹‚äºº
            
            // æ›´æ–°é’»çŸ³ä»»åŠ¡
            gameState.quests[1].progress = gameState.diamonds; // é’»çŸ³æ”¶é›†è€…
            gameState.quests[5].progress = gameState.diamonds; // ç™¾ä¸‡å¯Œç¿
            
            // æ›´æ–°å‡çº§ä»»åŠ¡
            gameState.quests[2].progress = gameState.upgrades.reduce((sum, upgrade) => sum + upgrade.owned, 0);
            
            // æ›´æ–°è‡ªåŠ¨ç‚¹å‡»å™¨ä»»åŠ¡
            gameState.quests[3].progress = gameState.autoClickers.reduce((sum, clicker) => sum + clicker.owned, 0);
            
            // æ›´æ–°çš®è‚¤ä»»åŠ¡
            gameState.quests[4].progress = gameState.skins.filter(skin => skin.owned && skin.id !== 1).length;
            
            // è½¬ç›˜ä»»åŠ¡åœ¨spinWheelå‡½æ•°ä¸­æ›´æ–°
            
            // æ£€æŸ¥ä»»åŠ¡å®ŒæˆçŠ¶æ€
            gameState.quests.forEach(quest => {
                if (!quest.completed && quest.progress >= quest.goal) {
                    quest.completed = true;
                    changed = true;
                }
            });
            
            if (changed) {
                renderQuests();
            }
        }
        
        // æ›´æ–°æˆå°±è¿›åº¦
        function updateAchievementProgress() {
            let changed = false;
            
            // æ›´æ–°ç‚¹å‡»ç›¸å…³æˆå°±
            gameState.achievements[0].progress = gameState.totalClicks; // åˆæ¬¡ç‚¹å‡»
            gameState.achievements[1].progress = gameState.totalClicks; // ç‚¹å‡»æ–°æ‰‹
            gameState.achievements[2].progress = gameState.totalClicks; // ç‚¹å‡»è¾¾äºº
            gameState.achievements[3].progress = gameState.totalClicks; // ç‚¹å‡»å¤§å¸ˆ
            
            // æ›´æ–°é’»çŸ³ç›¸å…³æˆå°±
            gameState.achievements[4].progress = gameState.diamonds; // é’»çŸ³æ”¶è—å®¶
            gameState.achievements[5].progress = gameState.diamonds; // é’»çŸ³å¤§äº¨
            gameState.achievements[6].progress = gameState.diamonds; // é’»çŸ³ä¹‹ç‹
            
            // æ›´æ–°è‡ªåŠ¨ç‚¹å‡»å™¨æˆå°±
            gameState.achievements[7].progress = gameState.autoClickers.reduce((sum, clicker) => sum + clicker.owned, 0);
            gameState.achievements[8].progress = gameState.achievements[7].progress; // è‡ªåŠ¨åŒ–ä¸“å®¶
            
            // æ›´æ–°çš®è‚¤æˆå°±
            gameState.achievements[9].progress = gameState.skins.filter(skin => skin.owned && skin.id !== 1).length; // çš®è‚¤æ”¶è—å®¶
            gameState.achievements[10].progress = gameState.achievements[9].progress; // çš®è‚¤å¤§å¸ˆ
            
            // æ›´æ–°å‡çº§æˆå°±
            gameState.achievements[11].progress = gameState.upgrades.reduce((sum, upgrade) => sum + upgrade.owned, 0); // å‡çº§å¤§å¸ˆ
            gameState.achievements[12].progress = gameState.achievements[11].progress; // å‡çº§å®—å¸ˆ
            
            // è½¬ç›˜æˆå°±åœ¨spinWheelå‡½æ•°ä¸­æ›´æ–°
            
            // æŠ€èƒ½æˆå°±ï¼ˆéœ€è¦è·Ÿè¸ªæŠ€èƒ½ä½¿ç”¨æƒ…å†µï¼Œè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
            gameState.achievements[14].progress = gameState.skills.filter(skill => skill.lastUsed > 0).length; // æŠ€èƒ½è¾¾äºº
            
            // ä»»åŠ¡æˆå°±
            gameState.achievements[15].progress = gameState.quests.filter(quest => quest.claimed).length; // ä»»åŠ¡å®Œæˆè€…
            
            // å……å€¼æˆå°±
            // è¿™äº›æˆå°±åœ¨confirmRechargeå‡½æ•°ä¸­æ›´æ–°
            
            // ç­‰çº§æˆå°±
            gameState.achievements[18].progress = gameState.playerLevel; // æ¸¸æˆä¹‹ç¥
            
            // çš®è‚¤æ”¶é›†æˆå°±
            gameState.achievements[19].progress = gameState.skins.filter(skin => skin.owned).length; // ç»ˆææ”¶è—å®¶
            
            // æ£€æŸ¥å¹¶è§£é”æˆå°±
            gameState.achievements.forEach(achievement => {
                if (!achievement.unlocked && achievement.progress >= achievement.goal) {
                    achievement.unlocked = true;
                    gameState.diamonds += achievement.reward;
                    changed = true;
                    
                    // æ˜¾ç¤ºæˆå°±è§£é”é€šçŸ¥
                    showNotification(`æˆå°±è§£é”: ${achievement.name}! è·å¾—${achievement.reward}é’»çŸ³å¥–åŠ±`);
                }
            });
            
            if (changed) {
                updateUI();
                renderAchievements();
            }
        }
        
        // æ›´æ–°æŠ€èƒ½å†·å´
        function updateSkillCooldowns() {
            renderSkills();
        }
        
        // æ£€æŸ¥æ¿€æ´»çš„å¢ç›Šæ•ˆæœ
        function checkActiveBoosts() {
            const now = Math.floor(Date.now() / 1000);
            let changed = false;
            
            gameState.boosts.forEach(boost => {
                if (boost.active && boost.endTime <= now) {
                    boost.active = false;
                    changed = true;
                    
                    // æ˜¾ç¤ºé€šçŸ¥
                    showNotification(`${boost.name}å¢ç›Šæ•ˆæœå·²ç»“æŸ`);
                }
            });
            
            if (changed) {
                calculatePerSecond();
                renderBoosts();
            }
        }
        
        // æ›´æ–°å¢ç›Šæ•ˆæœè®¡æ—¶å™¨
        function updateBoostTimers() {
            const now = Math.floor(Date.now() / 1000);
            let changed = false;
            
            gameState.boosts.forEach(boost => {
                if (boost.active && boost.endTime <= now) {
                    boost.active = false;
                    changed = true;
                }
            });
            
            if (changed) {
                calculatePerSecond();
                renderBoosts();
            }
        }
        
        // æ›´æ–°ç©å®¶ç­‰çº§
        function updatePlayerLevel() {
            const newLevel = Math.floor(Math.sqrt(gameState.playerXP / 100)) + 1;
            if (newLevel > gameState.playerLevel) {
                const levelUp = newLevel - gameState.playerLevel;
                gameState.playerLevel = newLevel;
                
                // æ¯å‡ä¸€çº§è·å¾—é’»çŸ³å¥–åŠ±
                const reward = levelUp * 1000;
                gameState.diamonds += reward;
                
                showNotification(`æ­å–œå‡çº§åˆ° ${gameState.playerLevel} çº§! è·å¾—${reward}é’»çŸ³å¥–åŠ±`);
                updateUI();
                renderAchievements();
            }
        }
        
        // æ›´æ–°è½¬ç›˜æŒ‰é’®çŠ¶æ€
        function updateWheelButton() {
            const spinBtn = document.getElementById('wheelSpinBtn');
            if (!spinBtn) return;
            
            const canSpinFree = gameState.freeSpins > 0;
            const canSpinPaid = gameState.diamonds >= 500;
            
            if (canSpinFree) {
                spinBtn.disabled = false;
                spinBtn.textContent = `å…è´¹æŠ½å¥–å‰©ä½™: ${gameState.freeSpins}`;
            } else if (canSpinPaid) {
                spinBtn.disabled = false;
                spinBtn.textContent = "èŠ±è´¹500é’»çŸ³æŠ½å¥–";
            } else {
                spinBtn.disabled = true;
                spinBtn.textContent = "é’»çŸ³ä¸è¶³ (éœ€è¦500)";
            }
        }
        
        // æ£€æŸ¥å…è´¹æŠ½å¥–
        function checkFreeSpins() {
            // æ¯å¤©é‡ç½®å…è´¹æŠ½å¥–æ¬¡æ•°ï¼ˆå·²åœ¨loadGameStateä¸­å¤„ç†ï¼‰
            updateWheelButton();
        }
        
        // æ›´æ–°æ’è¡Œæ¦œä¸­çš„ç©å®¶æ•°æ®
        function updateLeaderboardPlayerData() {
            // åœ¨æ¸²æŸ“æ’è¡Œæ¦œæ—¶å¤„ç†
        }
        
        // æ•°æ®è¿ç§»
        function migrateGameData(savedState) {
            // ä»æ—§ç‰ˆæœ¬è¿ç§»æ•°æ®
            if (!savedState.gameVersion) {
                // è¿ç§»è‡ªåŠ¨ç‚¹å‡»å™¨æ•°æ®
                if (savedState.autoClickers === 0 || typeof savedState.autoClickers === 'number') {
                    savedState.autoClickers = autoClickersData.map(clicker => ({
                        ...clicker,
                        currentPrice: clicker.basePrice,
                        owned: 0
                    }));
                }
                
                // è¿ç§»è®¾ç½®
                if (!savedState.settings) {
                    savedState.settings = {
                        sound: true,
                        animation: true,
                        offlineEarnings: true,
                        autoSave: true
                    };
                }
                
                // è¿ç§»ç»Ÿè®¡
                if (!savedState.statistics) {
                    savedState.statistics = {
                        highestDiamonds: savedState.diamonds || 0,
                        highestPerSecond: 0,
                        totalDiamondsEarned: savedState.diamonds || 0,
                        totalUpgradesBought: 0,
                        totalSkinsUnlocked: 1,
                        totalAchievements: 0
                    };
                }
                
                savedState.gameVersion = GAME_CONFIG.version;
            }
        }
        
        // ============================================
        // äº‹ä»¶ç›‘å¬å™¨è®¾ç½®
        // ============================================
        
        function setupEventListeners() {
            // ç‚¹å‡»æŒ‰é’®
            document.getElementById('clickerButton').addEventListener('click', handleClick);
            
            // æ ‡ç­¾é¡µåˆ‡æ¢
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // æ›´æ–°æ´»è·ƒæ ‡ç­¾
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // æ˜¾ç¤ºå¯¹åº”å†…å®¹
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // å……å€¼é€‰é¡¹é€‰æ‹©
            document.querySelectorAll('.recharge-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.recharge-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    
                    const amount = parseInt(this.getAttribute('data-amount'));
                    const price = parseInt(this.getAttribute('data-price'));
                    gameState.selectedRechargeOption = { amount, price };
                });
            });
            
            // å……å€¼æŒ‰é’®
            document.getElementById('rechargeBtn').addEventListener('click', openRechargeModal);
            
            // å……å€¼æ¨¡æ€æ¡†æŒ‰é’®
            document.getElementById('checkPayment').addEventListener('click', checkPaymentStatus);
            document.getElementById('cancelRecharge').addEventListener('click', closeRechargeModal);
            
            // è½¬ç›˜æŠ½å¥–
            document.getElementById('spinWheel').addEventListener('click', spinWheel);
            document.getElementById('wheelSpinBtn').addEventListener('click', spinWheel);
            
            // å…³é—­æ¨¡æ€æ¡†ï¼ˆç‚¹å‡»èƒŒæ™¯ï¼‰
            document.getElementById('rechargeModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeRechargeModal();
                }
            });
            
            // æ–°çš„äº‹ä»¶ç›‘å¬å™¨
            setupSettings();
            
            // é¡µé¢ç¦»å¼€æ—¶ä¿å­˜
            window.addEventListener('beforeunload', () => {
                if (gameState.settings.autoSave) {
                    saveGameState();
                }
            });
            
            // é¡µé¢å¯è§æ€§å˜åŒ–
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    // é¡µé¢éšè—ï¼Œä¿å­˜æ¸¸æˆ
                    saveGameState();
                } else {
                    // é¡µé¢æ¢å¤ï¼Œæ£€æŸ¥ç¦»çº¿æ”¶ç›Š
                    checkOfflineEarnings();
                }
            });
        }
        
        // ============================================
        // åˆå§‹åŒ–æ¸¸æˆ
        // ============================================
        
        // ç¡®ä¿æ‰€æœ‰DOMå…ƒç´ éƒ½åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', () => {
            // æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§
            if (!localStorage) {
                alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæœ¬åœ°å­˜å‚¨ï¼Œæ¸¸æˆè¿›åº¦å°†æ— æ³•ä¿å­˜ã€‚');
            }
            
            // å¼€å§‹åˆå§‹åŒ–æ¸¸æˆ
            setTimeout(initGame, 100);
        });
    </script>
</body>
</html>